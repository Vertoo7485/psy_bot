# app/services/self_help/days/day_5_service.rb
module SelfHelp
  module Days
    class Day5Service < DayBaseService
      include TelegramMarkupHelper
      # ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
      DAY_NUMBER = 5
      EXERCISE_DURATION_MINUTES = 20
      
      def deliver_intro
        message_text = <<~MARKDOWN
          ðŸŽ¯ *Ð”ÐµÐ½ÑŒ 5: Ð”Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ* ðŸŽ¯

          **Ð¡Ð²ÑÐ·ÑŒ Ñ‚ÐµÐ»Ð° Ð¸ Ð¿ÑÐ¸Ñ…Ð¸ÐºÐ¸**

          Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ â€” ÑÑ‚Ð¾ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ Ñ‚ÐµÐ»Ð°, Ð½Ð¾ Ð¸ Ð¿Ñ€Ð¾ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ Ð¿ÑÐ¸Ñ…Ð¸ÐºÐ¸. Ð’Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð½Ð°Ñˆ Ð¼Ð¾Ð·Ð³ Ð²Ñ‹Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ½Ð´Ð¾Ñ€Ñ„Ð¸Ð½Ñ‹ â€” Â«Ð³Ð¾Ñ€Ð¼Ð¾Ð½Ñ‹ ÑÑ‡Ð°ÑÑ‚ÑŒÑÂ».

          **Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð°Ñ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ:**
          â€¢ Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ ÑÑ‚Ñ€ÐµÑÑÐ° Ð¸ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð¸
          â€¢ Ð£Ð»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ
          â€¢ ÐŸÐ¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÑÐ°Ð¼Ð¾Ð¾Ñ†ÐµÐ½ÐºÑƒ
          â€¢ Ð£Ð»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ½Ð°
          â€¢ Ð Ð°Ð·Ð²Ð¸Ð²Ð°ÐµÑ‚ Ð´Ð¸ÑÑ†Ð¸Ð¿Ð»Ð¸Ð½Ñƒ
        MARKDOWN
        
        send_message(text: message_text, parse_mode: 'Markdown')
        
        @user.set_self_help_step("day_#{DAY_NUMBER}_intro")
        
        send_message(
          text: "Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð² ÑÐ²Ð¾Ð¹ Ð´ÐµÐ½ÑŒ?",
          reply_markup: TelegramMarkupHelper.start_day_5_exercise_markup
        )
      end
      
      def deliver_exercise
        @user.set_self_help_step("day_#{DAY_NUMBER}_exercise_in_progress")
        
        exercise_text = <<~MARKDOWN
          ðŸƒ *Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ: ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ* ðŸƒ

          **Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ:**

          Ð£Ð´ÐµÐ»Ð¸Ñ‚Ðµ **#{EXERCISE_DURATION_MINUTES} Ð¼Ð¸Ð½ÑƒÑ‚** Ð»ÑŽÐ±Ð¾Ð¹ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²Ð°Ð¼ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ.

          **Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð½Ð° Ð²Ñ‹Ð±Ð¾Ñ€:**

          ðŸš¶ **ÐŸÑ€Ð¾Ð³ÑƒÐ»ÐºÐ° Ð½Ð° ÑÐ²ÐµÐ¶ÐµÐ¼ Ð²Ð¾Ð·Ð´ÑƒÑ…Ðµ**
          â€¢ #{EXERCISE_DURATION_MINUTES} Ð¼Ð¸Ð½ÑƒÑ‚ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ñ…Ð¾Ð´ÑŒÐ±Ñ‹
          â€¢ ÐÐ°Ð±Ð»ÑŽÐ´Ð°Ð¹Ñ‚Ðµ Ð·Ð° Ð¾ÐºÑ€ÑƒÐ¶Ð°ÑŽÑ‰Ð¸Ð¼ Ð¼Ð¸Ñ€Ð¾Ð¼
          â€¢ Ð”Ñ‹ÑˆÐ¸Ñ‚Ðµ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾

          ðŸ’ƒ **Ð¢Ð°Ð½Ñ†Ñ‹**
          â€¢ Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð»ÑŽÐ±Ð¸Ð¼ÑƒÑŽ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ
          â€¢ Ð”Ð²Ð¸Ð³Ð°Ð¹Ñ‚ÐµÑÑŒ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾
          â€¢ ÐŸÐ¾Ð»ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ ÑƒÐ´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð¸Ðµ

          ðŸ§˜ **Ð™Ð¾Ð³Ð° Ð¸Ð»Ð¸ Ñ€Ð°ÑÑ‚ÑÐ¶ÐºÐ°**
          â€¢ #{EXERCISE_DURATION_MINUTES} Ð¼Ð¸Ð½ÑƒÑ‚ ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐ¹ Ð·Ð°Ñ€ÑÐ´ÐºÐ¸
          â€¢ ÐŸÑ€Ð¾ÑÑ‚Ñ‹Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð½Ð° Ð³Ð¸Ð±ÐºÐ¾ÑÑ‚ÑŒ
          â€¢ Ð¡Ð»ÑƒÑˆÐ°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ðµ Ñ‚ÐµÐ»Ð¾

          ðŸ‹ï¸ **Ð¡Ð¸Ð»Ð¾Ð²Ð°Ñ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ°**
          â€¢ ÐžÑ‚Ð¶Ð¸Ð¼Ð°Ð½Ð¸Ñ, Ð¿Ñ€Ð¸ÑÐµÐ´Ð°Ð½Ð¸Ñ, Ð¿Ð»Ð°Ð½ÐºÐ°
          â€¢ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²ÐµÑ Ñ‚ÐµÐ»Ð°
          â€¢ Ð”ÐµÐ»Ð°Ð¹Ñ‚Ðµ Ð² ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾Ð¼ Ñ‚ÐµÐ¼Ð¿Ðµ
        MARKDOWN
        
        send_message(text: exercise_text, parse_mode: 'Markdown')
        
        send_message(
          text: <<~MARKDOWN,
            **Ð’Ð°Ð¶Ð½Ð¾:**
            â€¢ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð½Ð¾ÑÐ¸Ñ‚ ÑƒÐ´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð¸Ðµ
            â€¢ ÐÐµ ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°Ð¹Ñ‚Ðµ ÑÐµÐ±Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸
            â€¢ ÐÐ°Ñ‡Ð¸Ð½Ð°Ð¹Ñ‚Ðµ Ñ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ

            ÐšÐ¾Ð³Ð´Ð° Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ñ‚Ðµ, Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ:
          MARKDOWN
          reply_markup: TelegramMarkupHelper.day_5_exercise_completed_markup
        )
      end
      
      def complete_exercise
        @user.set_self_help_step("day_#{DAY_NUMBER}_completed")
        
        message = <<~MARKDOWN
          ðŸŒŸ *ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾!* ðŸŒŸ

          Ð’Ñ‹ Ð¿Ð¾Ð·Ð°Ð±Ð¾Ñ‚Ð¸Ð»Ð¸ÑÑŒ Ð¾ ÑÐ²Ð¾ÐµÐ¼ Ñ‚ÐµÐ»Ðµ Ð¸ Ð¿ÑÐ¸Ñ…Ð¸ÐºÐµ!

          **Ð§Ñ‚Ð¾ Ð²Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸ Ð¾Ñ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸:**
          â€¢ Ð’Ñ‹Ð±Ñ€Ð¾Ñ ÑÐ½Ð´Ð¾Ñ€Ñ„Ð¸Ð½Ð¾Ð² (Ð³Ð¾Ñ€Ð¼Ð¾Ð½Ð¾Ð² ÑÑ‡Ð°ÑÑ‚ÑŒÑ)
          â€¢ Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð»Ð° (Ð³Ð¾Ñ€Ð¼Ð¾Ð½Ð° ÑÑ‚Ñ€ÐµÑÑÐ°)
          â€¢ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ ÐºÑ€Ð¾Ð²Ð¾Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ
          â€¢ ÐŸÐ¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ðµ ÑÐ½ÐµÑ€Ð³Ð¸Ð¸

          **Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:**
          â€¢ Ð¡Ñ‚Ð°Ñ€Ð°Ð¹Ñ‚ÐµÑÑŒ Ð´Ð²Ð¸Ð³Ð°Ñ‚ÑŒÑÑ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ
          â€¢ ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ
          â€¢ ÐÐ°Ñ‡Ð¸Ð½Ð°Ð¹Ñ‚Ðµ Ñ Ð¼Ð°Ð»Ð¾Ð³Ð¾
          â€¢ ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ
        MARKDOWN
        
        send_message(text: message, parse_mode: 'Markdown')
        propose_next_day
      end
      
      # Ð˜Ð—ÐœÐ•ÐÐ•ÐÐ˜Ð• 1: ÐœÐµÐ½ÑÐµÐ¼ Ð½Ð° false, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ deliver_exercise Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
      def should_deliver_exercise_immediately?
        false
      end
      
      # Ð˜Ð—ÐœÐ•ÐÐ•ÐÐ˜Ð• 2: Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¼ÐµÑ‚Ð¾Ð´ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
      def handle_exercise_consent
        # Ð­Ñ‚Ð¾Ñ‚ Ð¼ÐµÑ‚Ð¾Ð´ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÐµÑ‚ "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ"
        deliver_exercise
      end
    end
  end
end