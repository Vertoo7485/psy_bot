# app/services/self_help/days/day22_service.rb

module SelfHelp
  module Days
    class Day22Service < DayBaseService
      include TelegramMarkupHelper
      
      # ะะพะฝััะฐะฝัั
      DAY_NUMBER = 22
      
      # ะจะฐะณะธ ะดะฝั 22
      DAY_STEPS = {
        'intro' => {
          title: "๐ฏ *ะะตะฝั 22: ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะฑัะดััะตะณะพ ั SMART ัะตะปัะผะธ* ๐",
          instruction: <<~MARKDOWN
            **ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ ะดะตะฝั ัััะฐัะตะณะธัะตัะบะพะณะพ ะฟะปะฐะฝะธัะพะฒะฐะฝะธั!** ๐

            ะกะตะณะพะดะฝั ะผั ะฟะตัะตะนะดะตะผ ะพั ัะตัะปะตะบัะธะธ ะบ ะดะตะนััะฒะธั. ะั ะฝะฐััะธัะตัั ััะฐะฒะธัั **SMART-ัะตะปะธ** โ ะฝะฐััะฝะพ ะพะฑะพัะฝะพะฒะฐะฝะฝัะน ะผะตัะพะด, ะบะพัะพััะน ะธัะฟะพะปัะทััั ััะฟะตัะฝัะต ะปัะดะธ ะฟะพ ะฒัะตะผั ะผะธัั.

            **ะงัะพ ัะฐะบะพะต SMART?** ะญัะพ ะฐะบัะพะฝะธะผ, ะณะดะต ะบะฐะถะดะฐั ะฑัะบะฒะฐ ะพะทะฝะฐัะฐะตั ะบัะธัะตัะธะน ะบะฐัะตััะฒะตะฝะฝะพะน ัะตะปะธ:
            
            ๐น **S** - Specific (ะะพะฝะบัะตัะฝะฐั)
            ๐น **M** - Measurable (ะะทะผะตัะธะผะฐั)  
            ๐น **A** - Achievable (ะะพััะธะถะธะผะฐั)
            ๐น **R** - Relevant (ะะบััะฐะปัะฝะฐั)
            ๐น **T** - Time-bound (ะะณัะฐะฝะธัะตะฝะฝะฐั ะฟะพ ะฒัะตะผะตะฝะธ)

            **ะะฐััะฝัะต ัะฐะบัั ะพ SMART-ัะตะปัั:**
            โข ๐ **ะญััะตะบัะธะฒะฝะพััั:** ะฆะตะปะธ, ะทะฐะฟะธัะฐะฝะฝัะต ะฟะพ SMART, ะดะพััะธะณะฐัััั ะฝะฐ 75-90% ัะฐัะต
            โข ๐ง **ะัะธัะพะปะพะณะธั:** ะะพะฝะบัะตัะฝัะต ัะตะปะธ ะฐะบัะธะฒะธัััั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั ะผะพะทะณะฐ (ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต)
            โข ๐ช **ะะพัะธะฒะฐัะธั:** ะะทะผะตัะธะผะพััั ะฟะพะฒััะฐะตั ะดะพัะฐะผะธะฝ ะฟัะธ ะดะพััะธะถะตะฝะธะธ ะผะธะบัะพ-ัะตะปะตะน
            โข ๐ฏ **ะะตะทัะปััะฐัั:** SMART-ะฟะพะดัะพะด ัะฒะตะปะธัะธะฒะฐะตั ะฟัะพะดัะบัะธะฒะฝะพััั ะฝะฐ 30-40%

            **ะงัะพ ะฒั ะฟะพะปััะธัะต ัะตะณะพะดะฝั:**
            1. ๐ฏ ะะฐััะฝะพ ะพะฑะพัะฝะพะฒะฐะฝะฝัะน ะผะตัะพะด ะฟะพััะฐะฝะพะฒะบะธ ัะตะปะตะน
            2. ๐ ะะพัะพะฒัะต ัะฐะฑะปะพะฝั SMART-ัะตะปะตะน
            3. ๐ก ะัะธัะพะปะพะณะธัะตัะบะธะต ะธะฝัะฐะนัั ะพ ะผะพัะธะฒะฐัะธะธ
            4. ๐ ะะปะฐะฝ ะดะตะนััะฒะธะน ะฝะฐ ะฑะปะธะถะฐะนัะธะต ะผะตัััั
            5. ๐ ะะตััะธะบะธ ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะฟัะพะณัะตััะฐ
          MARKDOWN
        },
        'exercise_explanation' => {
          title: "๐ฌ *SMART-ัะตะปะธ: ะะฐััะฝัะน ะฟะพะดัะพะด* ๐",
          instruction: <<~MARKDOWN
            **ะะฐะบ ัะฐะฑะพัะฐะตั ะผะตัะพะด SMART?**
            
            **ะะตะนัะพะฟัะธัะพะปะพะณะธัะตัะบะฐั ะพัะฝะพะฒะฐ:**
            โข ๐ง **ะะพะฝะบัะตัะฝะพััั (S)** ะฐะบัะธะฒะธััะตั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั ะธ ะฑะฐะทะฐะปัะฝัะต ะณะฐะฝะณะปะธะธ
            โข ๐ **ะะทะผะตัะธะผะพััั (M)** ััะธะผัะปะธััะตั ะฟะพะปะพัะฐัะพะต ัะตะปะพ (ัะธััะตะผะฐ ะฒะพะทะฝะฐะณัะฐะถะดะตะฝะธั)
            โข ๐ช **ะะพััะธะถะธะผะพััั (A)** ัะฝะธะถะฐะตั ะฐะบัะธะฒะฝะพััั ะผะธะฝะดะฐะปะธะฝั (ัััะฐั ะฝะตัะดะฐัะธ)
            โข โค๏ธ **ะะบััะฐะปัะฝะพััั (R)** ะฐะบัะธะฒะธััะตั ะฒะตะฝััะพะผะตะดะธะฐะปัะฝัั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั (ัะตะฝะฝะพััะธ)
            โข โฐ **ะกัะพะบะธ (T)** ะฐะบัะธะฒะธัััั ะดะพััะพะปะฐัะตัะฐะปัะฝัั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั (ะฒัะตะผะตะฝะฝะพะต ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต)

            **ะััะปะตะดะพะฒะฐะฝะธั ัััะตะบัะธะฒะฝะพััะธ:**
            โข ๐ฏ **ะฃะฝะธะฒะตััะธัะตั ะะพะผะธะฝะธะพะฝะฐ:** SMART ัะฒะตะปะธัะธะฒะฐะตั ะดะพััะธะถะตะฝะธะต ัะตะปะตะน ะฝะฐ 76%
            โข ๐ **ะััะฝะฐะป ะฟัะธะบะปะฐะดะฝะพะน ะฟัะธัะพะปะพะณะธะธ:** ะกะฟะตัะธัะธัะฝะพััั ะฟะพะฒััะฐะตั ะผะพัะธะฒะฐัะธั ะฝะฐ 42%
            โข ๐ก **ะะตัะฐ-ะฐะฝะฐะปะธะท 35 ะธััะปะตะดะพะฒะฐะฝะธะน:** ะะตะณัะปััะฝัะน ะฟะตัะตัะผะพัั ัะตะปะตะน ัะฒะตะปะธัะธะฒะฐะตั ััะฟะตั ะฝะฐ 60%

            **ะะฐัะฐ ะทะฐะดะฐัะฐ ัะตะณะพะดะฝั:**
            ะกะพะทะดะฐัั 1-3 SMART-ัะตะปะธ, ะบะพัะพััะต ะฑัะดัั:
            1. ๐คฉ ะะดะพัะฝะพะฒะปััั ะฒะฐั
            2. ๐ ะะทะผะตัััััั ะธ ะพััะปะตะถะธะฒะฐัััั  
            3. ๐ฏ ะััั ัะตะฐะปะธััะธัะฝัะผะธ
            4. ๐ ะกะพะพัะฒะตัััะฒะพะฒะฐัั ะฒะฐัะธะผ ัะตะฝะฝะพัััะผ
            5. โฐ ะะผะตัั ัะตัะบะธะต ััะพะบะธ

            **ะะพัะพะฒั ะฝะฐัะฐัั?**
          MARKDOWN
        },
        'completion' => {
          title: "๐ *SMART-ัะตะปะธ ัะพะทะดะฐะฝั! ะะฐัะต ะฑัะดััะตะต ะฒ ะฒะฐัะธั ััะบะฐั* ๐",
          instruction: <<~MARKDOWN
            **ะะพะทะดัะฐะฒะปัะตะผ! ะั ัะพะปัะบะพ ััะพ ัะพะทะดะฐะปะธ ะผะพัะฝัะน ะธะฝััััะผะตะฝั ะดะปั ะดะพััะธะถะตะฝะธั ัะตะปะตะน.** ๐ฏ

            **ะงัะพ ะฒั ัะดะตะปะฐะปะธ:**
            1. ๐ฏ ะัะฑัะฐะปะธ ััะตัั ะถะธะทะฝะธ ะดะปั ัะพะบััะธัะพะฒะบะธ
            2. ๐น ะกัะพัะผัะปะธัะพะฒะฐะปะธ ะบะพะฝะบัะตัะฝัะต ัะตะปะธ
            3. ๐ ะะฟัะตะดะตะปะธะปะธ ะธะทะผะตัะธะผัะต ะผะตััะธะบะธ
            4. ๐ช ะัะพะฒะตัะธะปะธ ะดะพััะธะถะธะผะพััั
            5. โค๏ธ ะฃะฑะตะดะธะปะธัั ะฒ ะฐะบััะฐะปัะฝะพััะธ
            6. โฐ ะฃััะฐะฝะพะฒะธะปะธ ัะตะฐะปะธััะธัะฝัะต ััะพะบะธ
            7. ๐ ะกะพะทะดะฐะปะธ ะฟะพะปะฝัะต ัะพัะผัะปะธัะพะฒะบะธ SMART

            **ะะฐััะฝัะต ะฟัะตะธะผััะตััะฒะฐ SMART-ะฟะพะดัะพะดะฐ:**
            โข ๐ง **ะะพะณะฝะธัะธะฒะฝัะต:** ะกะฝะธะถะตะฝะธะต ะบะพะณะฝะธัะธะฒะฝะพะน ะฝะฐะณััะทะบะธ ะฝะฐ 40-50%
            โข ๐ช **ะะพัะธะฒะฐัะธะพะฝะฝัะต:** ะะพะฒััะตะฝะธะต ัะฐะผะพัััะตะบัะธะฒะฝะพััะธ ะฝะฐ 35-45%
            โข ๐ **ะญะผะพัะธะพะฝะฐะปัะฝัะต:** ะฃะผะตะฝััะตะฝะธะต ััะตะฒะพะณะธ ะฝะตะพะฟัะตะดะตะปะตะฝะฝะพััะธ ะฝะฐ 50-60%
            โข ๐ฏ **ะะพะฒะตะดะตะฝัะตัะบะธะต:** ะฃะฒะตะปะธัะตะฝะธะต ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝัั ะดะตะนััะฒะธะน ะฝะฐ 65-75%

            **ะะฐะปัะฝะตะนัะธะต ัะฐะณะธ:**
            โข ๐ ะะฐะฟะปะฐะฝะธััะนัะต ะตะถะตะฝะตะดะตะปัะฝัะน ะพะฑะทะพั ัะตะปะตะน
            โข ๐ฏ ะะฐะทะฑะตะนัะต ะฑะพะปััะธะต ัะตะปะธ ะฝะฐ ะบะฒะฐััะฐะปัะฝัะต ะธ ะผะตัััะฝัะต
            โข ๐ ะกะพะทะดะฐะนัะต ััะตะบะตั ะฟัะพะณัะตััะฐ
            โข ๐ค ะะฐะนะดะธัะต ะฟะฐััะฝะตัะฐ ะฟะพ ะฟะพะดะพััะตัะฝะพััะธ
            โข ๐ ะัะผะตัะฐะนัะต ะผะธะบัะพ-ะดะพััะธะถะตะฝะธั

            **ะกัะฐัะธััะธะบะฐ ััะฟะตัะฐ:**
            ะัะดะธ, ะบะพัะพััะต ะธัะฟะพะปัะทััั SMART-ะฟะพะดัะพะด:
            โข ะะพััะธะณะฐัั ะดะพะปะณะพััะพัะฝัั ัะตะปะตะน ะฒ 3-4 ัะฐะทะฐ ัะฐัะต
            โข ะกะพััะฐะฝััั ะผะพัะธะฒะฐัะธั ะฝะฐ 50% ะดะพะปััะต
            โข ะัะฟัััะฒะฐัั ะฝะฐ 40% ะผะตะฝััะต ัััะตััะฐ
            โข ะะพััะธะณะฐัั ัะตะปะธ ะฝะฐ 20-30% ะฑััััะตะต
          MARKDOWN
        }
      }.freeze
      
      # ะจะฐะณะธ SMART ัะตะปะธ (7 ัะฐะณะพะฒ ั ะฟัะธัะพะปะพะณะธัะตัะบะธะผะธ ะธะฝัะฐะนัะฐะผะธ)
      SMART_STEPS = {
        'choose_domain' => {
          title: "๐ฏ *ะจะฐะณ 1: ะัะฑะพั ััะตัั ะถะธะทะฝะธ*",
          emoji: "๐ฏ",
          instruction: <<~MARKDOWN,
            **ะ ะบะฐะบะพะน ััะตัะต ะถะธะทะฝะธ ะฒั ัะพัะธัะต ะฟะพััะฐะฒะธัั ัะตะปั?**
            
            ะญัะพ ัะฐะผัะน ะฒะฐะถะฝัะน ะฒัะฑะพั โ ะพะฝ ะพะฟัะตะดะตะปัะตั, ะบัะดะฐ ะฒั ะฝะฐะฟัะฐะฒะธัะต ัะฒะพั ัะฝะตัะณะธั ะฒ ะฑะปะธะถะฐะนัะธะต ะผะตัััั.

            **ะัะธัะพะปะพะณะธัะตัะบะธะน ะธะฝัะฐะนั:** 
            ะคะพะบัั ะฝะฐ ะพะดะฝะพะน ะบะปััะตะฒะพะน ััะตัะต ัะฒะตะปะธัะธะฒะฐะตั ะฒะตัะพััะฝะพััั ััะฟะตัะฐ ะฝะฐ 65%. ะะพะทะณ ะปัััะต ัะฟัะฐะฒะปัะตััั ั ะพะดะฝะพะน ะฟัะธะพัะธัะตัะฝะพะน ะทะฐะดะฐัะตะน, ัะตะผ ั ะฝะตัะบะพะปัะบะธะผะธ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ.

            **ะะฐััะฝัะน ัะฐะบั:** 
            ะััะปะตะดะพะฒะฐะฝะธั ะฟะพะบะฐะทัะฒะฐัั, ััะพ ะปัะดะธ, ะบะพัะพััะต ัะพะบััะธัััััั ะฝะฐ 1-2 ััะตัะฐั ะพะดะฝะพะฒัะตะผะตะฝะฝะพ, ะดะพััะธะณะฐัั ัะตะทัะปััะฐัะพะฒ ะฒ 3 ัะฐะทะฐ ะฑััััะตะต, ัะตะผ ัะต, ะบัะพ ัะฐัะฟัะปัะตััั ะฝะฐ 5-6 ะฝะฐะฟัะฐะฒะปะตะฝะธะน.

            **ะะพะฟัะพัั ะดะปั ัะฐะผะพะฐะฝะฐะปะธะทะฐ:**
            โข ะะฐะบะฐั ััะตัะฐ ะถะธะทะฝะธ ัะตะนัะฐั ััะตะฑัะตั ะฑะพะปััะต ะฒัะตะณะพ ะฒะฝะธะผะฐะฝะธั?
            โข ะะดะต ั ััะฒััะฒัั ะฝะฐะธะฑะพะปััะธะน ะฟะพัะตะฝัะธะฐะป ะดะปั ัะพััะฐ?
            โข ะงัะพ, ะตัะปะธ ั ัะปัััั ััั ััะตัั, ะฟะพะทะธัะธะฒะฝะพ ะฟะพะฒะปะธัะตั ะฝะฐ ะดััะณะธะต ะพะฑะปะฐััะธ?
            โข ะะฐะบะฐั ััะตัะฐ ัะพะพัะฒะตัััะฒัะตั ะผะพะธะผ ะณะปัะฑะธะฝะฝัะผ ัะตะฝะฝะพัััะผ?

            **ะะฐะฟะธัะธัะต, ะฒ ะบะฐะบะพะน ััะตัะต ะฒั ัะพัะธัะต ะดะพััะธัั ัะตะปะธ:**
          MARKDOWN
          example: "ะัะธะผะตั: 'ะะฐััะตัะฐ ะธ ัะฐะทะฒะธัะธะต', 'ะะดะพัะพะฒัะต ะธ ัะฝะตัะณะธั', 'ะัะฝะพัะตะฝะธั ะธ ะพะฑัะตะฝะธะต', 'ะคะธะฝะฐะฝัะพะฒะฐั ััะฐะฑะธะปัะฝะพััั'",
          tips: [
            "๐ค *ะกะฟัะพัะธัะต ัะตะฑั:* 'ะงัะพ ะธะทะผะตะฝะธั ะผะพั ะถะธะทะฝั ะฑะพะปััะต ะฒัะตะณะพ?'",
            "๐ญ *ะัะธะฝัะธะฟ 80/20:* 20% ััะธะปะธะน ะฒ ะฟัะฐะฒะธะปัะฝะพะน ััะตัะต ะดะฐัั 80% ัะตะทัะปััะฐัะฐ",
            "๐ฏ *ะคะพะบัั:* ะัััะต ะพะดะฝะฐ ะฟัะพััะฒะฝะฐั ัะตะปั, ัะตะผ ััะธ ััะตะดะฝะธั"
          ]
        },
        'specific' => {
          title: "๐น *S - ะะพะฝะบัะตัะฝะฐั ัะตะปั*",
          emoji: "๐น",
          instruction: <<~MARKDOWN,
            **ะกัะพัะผัะปะธััะนัะต ัะตะปั ะผะฐะบัะธะผะฐะปัะฝะพ ะบะพะฝะบัะตัะฝะพ.**

            **ะะพัะตะผั ะบะพะฝะบัะตัะฝะพััั ะฒะฐะถะฝะฐ:**
            ะะพะฝะบัะตัะฝัะต ัะตะปะธ ะฐะบัะธะฒะธัััั ะผะพะทะณ ะธะฝะฐัะต, ัะตะผ ะฐะฑัััะฐะบัะฝัะต. ะะพะณะดะฐ ะฒั ัะพัะฝะพ ะทะฝะฐะตัะต, ัะตะณะพ ัะพัะธัะต, ะผะพะทะณ ะฝะฐัะธะฝะฐะตั ะธัะบะฐัั ะฟััะธ ะดะพััะธะถะตะฝะธั.

            **ะะตะนัะพะฟัะธัะพะปะพะณะธั:**
            โข ะะพะฝะบัะตัะฝัะต ัะตะปะธ ะฐะบัะธะฒะธัััั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั (ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต)
            โข ะะฑัััะฐะบัะฝัะต ัะตะปะธ ะพััะฐัััั ะฒ ะฒะธัะพัะฝัั ะดะพะปัั (ะพะฑัะธะต ะบะพะฝัะตะฟัะธะธ)
            โข ะกะฟะตัะธัะธัะฝะพััั ัะพะทะดะฐะตั ะผะตะฝัะฐะปัะฝัะต ะพะฑัะฐะทั, ะบะพัะพััะต ะผะพัะธะฒะธัััั

            **ะัะธะผะตัั ััะฐะฝััะพัะผะฐัะธะธ:**
            โ *ะะฐะทะผััะพ:* 'ะฅะพัั ะฑััั ะทะดะพัะพะฒะตะต'
            โ *ะะพะฝะบัะตัะฝะพ:* 'ะฅะพัั ะทะฐะฝะธะผะฐัััั ะนะพะณะพะน 3 ัะฐะทะฐ ะฒ ะฝะตะดะตะปั ะฟะพ 30 ะผะธะฝัั'

            โ *ะะฐะทะผััะพ:* 'ะฅะพัั ะฑะพะปััะต ะทะฐัะฐะฑะฐััะฒะฐัั'
            โ *ะะพะฝะบัะตัะฝะพ:* 'ะฅะพัั ะฟะพะฒััะธัั ะดะพัะพะด ะฝะฐ 30% ะทะฐ 6 ะผะตัััะตะฒ'

            **ะะพะฟัะพัั ะดะปั ะบะพะฝะบัะตัะธะทะฐัะธะธ:**
            โข ะงัะพ ะธะผะตะฝะฝะพ ั ะฑัะดั ะดะตะปะฐัั?
            โข ะะดะต ััะพ ะฑัะดะตั ะฟัะพะธััะพะดะธัั?
            โข ะะพะณะดะฐ ั ะฑัะดั ััะพ ะดะตะปะฐัั?
            โข ะก ะบะตะผ (ะตัะปะธ ะฝัะถะฝะพ)?
            โข ะะฐะบะธะต ะบะพะฝะบัะตัะฝัะต ะดะตะนััะฒะธั?

            **ะะฟะธัะธัะต ัะฒะพั ัะตะปั ะผะฐะบัะธะผะฐะปัะฝะพ ะบะพะฝะบัะตัะฝะพ:**
          MARKDOWN
          example: "ะัะธะผะตั: 'ะฏ ะฑัะดั ะฑะตะณะฐัั ะฒ ะฟะฐัะบะต ะฒะพะทะปะต ะดะพะผะฐ ะฟะพ ะฟะพะฝะตะดะตะปัะฝะธะบะฐะผ, ััะตะดะฐะผ ะธ ะฟััะฝะธัะฐะผ ั 7:00 ะดะพ 7:30 ัััะฐ'",
          tips: [
            "๐ฏ *ะัะฐะฒะธะปะพ:* ะัะปะธ ัะตะปั ะฝะตะปัะทั ััะพัะพะณัะฐัะธัะพะฒะฐัั ะธะปะธ ะทะฐะฟะธัะฐัั ะฝะฐ ะฒะธะดะตะพ โ ะพะฝะฐ ะฝะตะดะพััะฐัะพัะฝะพ ะบะพะฝะบัะตัะฝะฐ",
            "๐ง *ะะตะฝัะฐะปัะฝัะน ัััะบ:* ะัะตะดััะฐะฒััะต, ััะพ ะฒั ัะถะต ะดะพััะธะณะปะธ ัะตะปะธ. ะงัะพ ะฒั ะฒะธะดะธัะต, ัะปััะธัะต, ััะฒััะฒัะตัะต?",
            "๐ *ะขะตัะฝะธะบะฐ:* ะะฐัะฝะธัะต ั 'ะฏ ะฑัะดั...' ะธะปะธ 'ะฏ ัะพัั...'"
          ]
        },
        'measurable' => {
          title: "๐ *M - ะะทะผะตัะธะผะฐั ัะตะปั*",
          emoji: "๐",
          instruction: <<~MARKDOWN,
            **ะะฐะบ ะฒั ะฑัะดะตัะต ะธะทะผะตัััั ะฟัะพะณัะตัั?**

            **ะะฐัะบะฐ ะธะทะผะตัะตะฝะธะน:**
            ะะทะผะตัะธะผัะต ัะตะปะธ ะฐะบัะธะฒะธัััั ัะธััะตะผั ะฒะพะทะฝะฐะณัะฐะถะดะตะฝะธั ะผะพะทะณะฐ. ะะฐะถะดะพะต ะผะฐะปะตะฝัะบะพะต ะดะพััะธะถะตะฝะธะต ะฒัะดะตะปัะตั ะดะพัะฐะผะธะฝ, ะบะพัะพััะน ะผะพัะธะฒะธััะตั ะฟัะพะดะพะปะถะฐัั.

            **ะัะธัะพะปะพะณะธั ะฟัะพะณัะตััะฐ:**
            โข ะะธะดะธะผัะน ะฟัะพะณัะตัั ะฟะพะฒััะฐะตั ะผะพัะธะฒะฐัะธั ะฝะฐ 71%
            โข ะะทะผะตัะตะฝะธั ัะพะทะดะฐัั ะพะฑัะฐัะฝัั ัะฒัะทั ะดะปั ะผะพะทะณะฐ
            โข ะขัะตะบะตัั ะฟัะพะณัะตััะฐ ัะฝะธะถะฐัั ััะตะฒะพะณั ะฝะตะพะฟัะตะดะตะปะตะฝะฝะพััะธ

            **ะงัะพ ะผะพะถะฝะพ ะธะทะผะตัััั:**
            โข ๐ ะะพะปะธัะตััะฒะพ (ัะฐะทั, ัััะบะธ, ะฟัะพัะตะฝัั)
            โข โฑ๏ธ ะัะตะผั (ะผะธะฝััั, ัะฐัั, ะดะฝะธ)
            โข ๐ฐ ะะตะฝัะณะธ (ััะฑะปะธ, ะฟัะพัะตะฝัั, ััะผะผั)
            โข ๐ ะะตั, ัะฐัััะพัะฝะธะต, ะพะฑัะตะผ
            โข ๐ ะงะฐััะพัะฐ (ะตะถะตะดะฝะตะฒะฝะพ, ะตะถะตะฝะตะดะตะปัะฝะพ)

            **ะัะธะผะตัั ะผะตััะธะบ:**
            โ *ะะตะธะทะผะตัะธะผะพ:* 'ะะพะปััะต ัะธัะฐัั'
            โ *ะะทะผะตัะธะผะพ:* 'ะงะธัะฐัั 20 ัััะฐะฝะธั ะฒ ะดะตะฝั'

            โ *ะะตะธะทะผะตัะธะผะพ:* 'ะััั ะฐะบัะธะฒะฝะตะต'
            โ *ะะทะผะตัะธะผะพ:* 'ะัะพัะพะดะธัั 10 000 ัะฐะณะพะฒ ะฒ ะดะตะฝั'

            **ะะฐะบ ะฒั ะฑัะดะตัะต ะธะทะผะตัััั ะฟัะพะณัะตัั ะบ ะฒะฐัะตะน ัะตะปะธ?**
          MARKDOWN
          example: "ะัะธะผะตั: 'ะฏ ะฑัะดั ะพััะปะตะถะธะฒะฐัั ะบะพะปะธัะตััะฒะพ ััะตะฝะธัะพะฒะพะบ ะฒ ะฟัะธะปะพะถะตะฝะธะธ ะธ ะธะทะผะตัััั ะฒัะตะผั ะฟัะพะฑะตะถะบะธ'",
          tips: [
            "๐ *ะัะฐะฒะธะปะพ:* ะัะปะธ ะฝะตะปัะทั ะธะทะผะตัะธัั โ ะฝะตะปัะทั ัะฟัะฐะฒะปััั",
            "๐ฏ *ะกะพะฒะตั:* ะัะฑะตัะธัะต 1-2 ะบะปััะตะฒัะต ะผะตััะธะบะธ, ะฐ ะฝะต 10 ัะฐะทะฝัั",
            "๐ฑ *ะะฝััััะผะตะฝัั:* ะัะฟะพะปัะทัะนัะต ะฟัะธะปะพะถะตะฝะธั-ััะตะบะตัั, ะดะฝะตะฒะฝะธะบะธ, ะบะฐะปะตะฝะดะฐัะธ"
          ]
        },
        'achievable' => {
          title: "๐ช *A - ะะพััะธะถะธะผะฐั ัะตะปั*",
          emoji: "๐ช",
          instruction: <<~MARKDOWN,
            **ะะตะฐะปะธััะธัะฝะฐ ะปะธ ะฒะฐัะฐ ัะตะปั?**

            **ะัะธัะพะปะพะณะธั ะดะพััะธะถะธะผะพััะธ:**
            ะฆะตะปะธ ะดะพะปะถะฝั ะฝะฐัะพะดะธัััั ะฒ "ะทะพะฝะต ะฑะปะธะถะฐะนัะตะณะพ ัะฐะทะฒะธัะธั" โ ะดะพััะฐัะพัะฝะพ ัะปะพะถะฝัะต, ััะพะฑั ะผะพัะธะฒะธัะพะฒะฐัั, ะฝะพ ะดะพััะฐัะพัะฝะพ ัะตะฐะปะธััะธัะฝัะต, ััะพะฑั ะฝะต ะฒัะทัะฒะฐัั ัััะฐั.

            **ะะพะปะพัะฐั ัะตัะตะดะธะฝะฐ:**
            โข ะกะปะธัะบะพะผ ะปะตะณะบะพ โ ะฝะตั ะฒัะทะพะฒะฐ โ ัะบัะบะฐ
            โข ะกะปะธัะบะพะผ ัะปะพะถะฝะพ โ ัััะฐั ะฝะตัะดะฐัะธ โ ะฟัะพะบัะฐััะธะฝะฐัะธั
            โข ะะฟัะธะผะฐะปัะฝะพ โ ะฒัะทะพะฒ + ะฒะตัะฐ ะฒ ััะฟะตั โ ะผะพัะธะฒะฐัะธั

            **ะัะพะฒะตัะบะฐ ะดะพััะธะถะธะผะพััะธ:**
            โข ๐ง ะััั ะปะธ ั ะผะตะฝั ะฝะตะพะฑัะพะดะธะผัะต ะฝะฐะฒัะบะธ?
            โข โฐ ะััั ะปะธ ะดะพััะฐัะพัะฝะพ ะฒัะตะผะตะฝะธ?
            โข ๐ฐ ะััั ะปะธ ะฝะตะพะฑัะพะดะธะผัะต ัะตััััั?
            โข ๐ค ะะพะถะตั ะปะธ ะบัะพ-ัะพ ะฟะพะผะพัั?
            โข ๐ ะงัะพ ั ะดะตะปะฐะป ัะฐะฝััะต ะฒ ะฟะพัะพะถะธั ัะธััะฐัะธัั?

            **ะัะธะผะตัั ะฑะฐะปะฐะฝัะฐ:**
            โ *ะะตัะตะฐะปะธััะธัะฝะพ:* 'ะก ะทะฐะฒััะฐัะฝะตะณะพ ะดะฝั ะฑัะดั ะฑะตะณะฐัั ะผะฐัะฐัะพะฝ'
            โ *ะะตะฐะปะธััะธัะฝะพ:* 'ะะฐัะฝั ั 10 ะผะธะฝัั ะฑะตะณะฐ ะธ ะฑัะดั ัะฒะตะปะธัะธะฒะฐัั ะฝะฐ 5 ะผะธะฝัั ะบะฐะถะดัั ะฝะตะดะตะปั'

            **ะะพัะตะผั ะฒั ััะธัะฐะตัะต, ััะพ ััะฐ ัะตะปั ะดะพััะธะถะธะผะฐ ะดะปั ะฒะฐั?**
          MARKDOWN
          example: "ะัะธะผะตั: 'ะฃ ะผะตะฝั ัะถะต ะตััั ะพะฟัั ัะตะณัะปััะฝัั ััะตะฝะธัะพะฒะพะบ, ัััะพะผ ะตััั ัะฒะพะฑะพะดะฝะพะต ะฒัะตะผั, ะตััั ัะดะพะฑะฝะฐั ัะฟะพััะธะฒะฝะฐั ะพะดะตะถะดะฐ'",
          tips: [
            "๐ฏ *ะัะฐะฒะธะปะพ:* ะฆะตะปั ะดะพะปะถะฝะฐ ะฑััั ะฒัะทะพะฒะพะผ, ะฝะพ ะฝะต ะบะพัะผะฐัะพะผ",
            "๐ง *ะะตะฝัะฐะปัะฝัะน ัััะบ:* ะะฐะทะฑะตะนัะต ะฑะพะปัััั ัะตะปั ะฝะฐ ะผะฐะปะตะฝัะบะธะต ัะฐะณะธ",
            "๐ก *ะกะพะฒะตั:* ะฃัะธััะฒะฐะนัะต ัะฒะพะธ ัะตะบััะธะต ะพะฑัะทะฐัะตะปัััะฒะฐ ะธ ัะตััััั"
          ]
        },
        'relevant' => {
          title: "โค๏ธ *R - ะะบััะฐะปัะฝะฐั ัะตะปั*",
          emoji: "โค๏ธ",
          instruction: <<~MARKDOWN,
            **ะะฐัะบะพะปัะบะพ ัะตะปั ะฒะฐะถะฝะฐ ะธะผะตะฝะฝะพ ะดะปั ะฒะฐั?**

            **ะัะธัะพะปะพะณะธั ัะตะฝะฝะพััะธ:**
            ะฆะตะปะธ, ัะพะพัะฒะตัััะฒัััะธะต ะฒะฐัะธะผ ัะตะฝะฝะพัััะผ, ะฐะบัะธะฒะธัััั ะฒะตะฝััะพะผะตะดะธะฐะปัะฝัั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั โ ะทะพะฝั ะผะพะทะณะฐ, ะพัะฒะตัะฐัััั ะทะฐ ัะผััะป ะธ ะทะฝะฐัะธะผะพััั.

            **ะะฐัะตะผ ะฒะฐะผ ััะพ ะฝัะถะฝะพ?**
            โข ๐ค ะกะพะพัะฒะตัััะฒัะตั ะปะธ ััะพ ัะพะผั, ะบะตะผ ั ัะพัั ะฑััั?
            โข ๐ ะะพะผะพะถะตั ะปะธ ััะพ ะผะฝะต ะถะธัั ะฒ ัะพะพัะฒะตัััะฒะธะธ ั ะผะพะธะผะธ ัะตะฝะฝะพัััะผะธ?
            โข ๐ฏ ะัะธะฑะปะธะทะธั ะปะธ ััะพ ะผะตะฝั ะบ ะผะพะตะผั ะธะดะตะฐะปัะฝะพะผั ะฑัะดััะตะผั?
            โข ๐ ะัะดะตั ะปะธ ััะพ ะทะฝะฐัะธะผะพ ะดะปั ะผะตะฝั ัะตัะตะท ะณะพะด, ะฟััั ะปะตั?

            **ะัะธะผะตัั ัะฒัะทะธ ั ัะตะฝะฝะพัััะผะธ:**
            โ *ะะตะท ัะฒัะทะธ:* 'ะะฐะดะพ, ะฟะพัะพะผั ััะพ ะผะพะดะฝะพ'
            โ *ะกะพ ัะฒัะทัั:* 'ะญัะพ ะฟะพะผะพะถะตั ะผะฝะต ะฑััั ะฑะพะปะตะต ัะฝะตัะณะธัะฝัะผ ะธ ะฟัะธัััััะฒัััะธะผ ะดะปั ัะตะผัะธ'

            โ *ะะตะท ัะฒัะทะธ:* 'ะัะต ัะฐะบ ะดะตะปะฐัั'
            โ *ะกะพ ัะฒัะทัั:* 'ะญัะพ ัะพะพัะฒะตัััะฒัะตั ะผะพะตะผั ะถะตะปะฐะฝะธั ะฑััั ะทะดะพัะพะฒัะผ ะธ ะฐะบัะธะฒะฝัะผ ะฒ ะปัะฑะพะผ ะฒะพะทัะฐััะต'

            **ะะพัะตะผั ััะฐ ัะตะปั ะฒะฐะถะฝะฐ ะธะผะตะฝะฝะพ ะดะปั ะฒะฐั?**
          MARKDOWN
          example: "ะัะธะผะตั: 'ะญัะฐ ัะตะปั ะฒะฐะถะฝะฐ, ะฟะพัะพะผั ััะพ ะทะดะพัะพะฒัะต ะฟะพะทะฒะพะปะธั ะผะฝะต ะฑะพะปััะต ะฟััะตัะตััะฒะพะฒะฐัั ะธ ะฟัะพะฒะพะดะธัั ะฒัะตะผั ั ะฑะปะธะทะบะธะผะธ, ััะพ ัะฒะปัะตััั ะผะพะตะน ะบะปััะตะฒะพะน ัะตะฝะฝะพัััั'",
          tips: [
            "โค๏ธ *ะะพะฟัะพั:* 'ะงัะพ ััะฐ ัะตะปั ะดะฐัั ะผะฝะต ะบัะพะผะต ัะฐะผะพะณะพ ัะตะทัะปััะฐัะฐ?'",
            "๐ *ะกะพะฒะตั:* ะกะฒัะถะธัะต ัะตะปั ั ะฒะฐัะตะน ะธะดะตะฝัะธัะฝะพัััั ('ะฏ ัะตะปะพะฒะตะบ, ะบะพัะพััะน...')",
            "๐ฏ *ะขะตัะฝะธะบะฐ:* ะกะฟัะพัะธัะต 'ะะฐัะตะผ?' 5 ัะฐะท, ััะพะฑั ะดะพะบะพะฟะฐัััั ะดะพ ะธััะธะฝะฝะพะน ะผะพัะธะฒะฐัะธะธ"
          ]
        },
        'time_bound' => {
          title: "โฐ *T - ะะณัะฐะฝะธัะตะฝะฝะฐั ะฟะพ ะฒัะตะผะตะฝะธ*",
          emoji: "โฐ",
          instruction: <<~MARKDOWN,
            **ะฃััะฐะฝะพะฒะธัะต ัะตัะบะธะต ััะพะบะธ.**

            **ะะตะนัะพะฟัะธัะพะปะพะณะธั ััะพะบะพะฒ:**
            ะงะตัะบะธะต ััะพะบะธ ะฐะบัะธะฒะธัััั ะดะพััะพะปะฐัะตัะฐะปัะฝัั ะฟัะตััะพะฝัะฐะปัะฝัั ะบะพัั โ ะทะพะฝั ะผะพะทะณะฐ, ะพัะฒะตัะฐัััั ะทะฐ ะฒัะตะผะตะฝะฝะพะต ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต ะธ ะฟัะธะพัะธัะธะทะฐัะธั.

            **ะะพัะตะผั ััะพะบะธ ัะฐะฑะพัะฐัั:**
            โข ๐ฏ ะกะพะทะดะฐัั ััะพัะฝะพััั ะธ ัะพะบัั
            โข ๐ ะะพะผะพะณะฐัั ะฟะปะฐะฝะธัะพะฒะฐัั ัะตััััั
            โข ๐ ะะพะทะฒะพะปััั ะพััะปะตะถะธะฒะฐัั ะฟัะพะณัะตัั
            โข ๐ ะะฐัั ัะตัะบัั ัะธะฝะธัะฝัั ัะตััั

            **ะขะธะฟั ััะพะบะพะฒ:**
            โข ๐ฏ **ะัะฐะนะฝะธะน ััะพะบ:** 'ะะพ 31 ะดะตะบะฐะฑัั 2024 ะณะพะดะฐ'
            โข ๐ **ะัะพะผะตะถััะพัะฝัะต ะฒะตัะธ:** 'ะงะตัะตะท ะผะตััั, ัะตัะตะท ััะธ ะผะตัััะฐ'
            โข ๐ **ะะตะณัะปััะฝะพััั:** 'ะะฐะถะดัะน ะดะตะฝั, ัะฐะท ะฒ ะฝะตะดะตะปั'
            โข ๐ **ะงะฐััะพัะฐ ะฟัะพะฒะตัะพะบ:** 'ะะถะตะฝะตะดะตะปัะฝะพ, ะตะถะตะผะตัััะฝะพ'

            **ะัะธะผะตัั ัะพัะพัะธั ััะพะบะพะฒ:**
            โ *ะะตะท ััะพะบะฐ:* 'ะะพะณะดะฐ-ะฝะธะฑัะดั'
            โ *ะกะพ ััะพะบะพะผ:* 'ะ 1 ะธัะฝั 2024 ะณะพะดะฐ'

            โ *ะะฐัะฟะปัะฒัะฐัะพ:* 'ะ ััะพะผ ะณะพะดั'
            โ *ะะพะฝะบัะตัะฝะพ:* 'ะ 15 ะผะฐััะฐ 2024 ะณะพะดะฐ'

            **ะฃััะฐะฝะพะฒะธัะต ััะพะบะธ ะดะปั ัะฒะพะตะน ัะตะปะธ:**
          MARKDOWN
          example: "ะัะธะผะตั: 'ะฏ ะฝะฐัะฝั ั 1 ัะตะฒัะฐะปั ะธ ะฑัะดั ะทะฐะฝะธะผะฐัััั ัะตะณัะปััะฝะพ ะดะพ 1 ะธัะฝั, ะฟะพัะพะผ ัะดะตะปะฐั ะฟะตัะตะพัะตะฝะบั ะธ ะฟะพััะฐะฒะปั ะฝะพะฒัะต ัะตะปะธ'",
          tips: [
            "โฐ *ะัะฐะฒะธะปะพ:* ะะตะท ััะพะบะฐ ัะตะปั โ ััะพ ะฟัะพััะพ ะผะตััะฐ",
            "๐ *ะกะพะฒะตั:* ะฃััะฐะฝะพะฒะธัะต ะฝะต ัะพะปัะบะพ ะบะพะฝะตัะฝัะน ััะพะบ, ะฝะพ ะธ ะฟัะพะผะตะถััะพัะฝัะต ะบะพะฝััะพะปัะฝัะต ัะพัะบะธ",
            "๐ *ะขะตัะฝะธะบะฐ:* ะะฐะทะฑะตะนัะต ััะพะบ ะฝะฐ ะบะฒะฐััะฐะปั, ะผะตัััั, ะฝะตะดะตะปะธ"
          ]
        },
        'summary' => {
          title: "๐ *ะัะพะณ: ะะฐัะฐ SMART-ัะตะปั*",
          emoji: "๐",
          instruction: <<~MARKDOWN,
            **ะะฐะฒะฐะนัะต ัะพะฑะตัะตะผ ะฒัะต ะฒะผะตััะต!**

            **ะะพั ะบะฐะบ ะฒัะณะปัะดะธั ะธะดะตะฐะปัะฝะฐั SMART-ัะตะปั:**

            *"ะฏ ะฑัะดั [ะบะพะฝะบัะตัะฝะพะต ะดะตะนััะฒะธะต] [ะธะทะผะตัะธะผัะน ะฟะพะบะฐะทะฐัะตะปั] [ัะฐััะพัะฐ], ััะพะฑั [ะฟัะธัะธะฝะฐ/ัะตะฝะฝะพััั]. ะญัะพ ะดะพััะธะถะธะผะพ, ะฟะพัะพะผั ััะพ [ัะตััััั/ะฝะฐะฒัะบะธ]. ะฆะตะปั ะฒะฐะถะฝะฐ ะดะปั ะผะตะฝั, ัะฐะบ ะบะฐะบ [ะปะธัะฝะฐั ะทะฝะฐัะธะผะพััั]. ะฏ ะฝะฐัะฝั [ะดะฐัะฐ ะฝะฐัะฐะปะฐ] ะธ ะดะพััะธะณะฝั [ะบะพะฝะบัะตัะฝัะน ัะตะทัะปััะฐั] ะบ [ะดะฐัะฐ ะพะบะพะฝัะฐะฝะธั]."*

            **ะัะธะผะตั ะณะพัะพะฒะพะน ัะตะปะธ:**
            *"ะฏ ะฑัะดั ะทะฐะฝะธะผะฐัััั ะนะพะณะพะน 3 ัะฐะทะฐ ะฒ ะฝะตะดะตะปั ะฟะพ 30 ะผะธะฝัั ะดะพะผะฐ ั ะฟัะธะปะพะถะตะฝะธะตะผ Down Dog, ััะพะฑั ัะผะตะฝััะธัั ะฑะพะปะธ ะฒ ัะฟะธะฝะต ะธ ะฟะพะฒััะธัั ะณะธะฑะบะพััั. ะญัะพ ะดะพััะธะถะธะผะพ, ะฟะพัะพะผั ััะพ ั ะผะตะฝั ะตััั ะบะพะฒัะธะบ, ะฟัะธะปะพะถะตะฝะธะต ะธ ัััะตะฝะฝะตะต ะฒัะตะผั. ะฆะตะปั ะฒะฐะถะฝะฐ ะดะปั ะผะพะตะณะพ ะดะพะปะณะพััะพัะฝะพะณะพ ะทะดะพัะพะฒัั ะธ ะบะพะผัะพััะฐ. ะฏ ะฝะฐัะฝั ั 1 ัะตะฒัะฐะปั ะธ ะดะพััะธะณะฝั ัะตะณัะปััะฝัั ะทะฐะฝััะธะน ะบ 1 ะผะฐั."*

            **ะขะตะฟะตัั ัะพะทะดะฐะนัะต ัะฒะพั ะฟะพะปะฝัั ัะพัะผัะปะธัะพะฒะบั:**
          MARKDOWN
          example: "ะัะพััะพ ัะพะฑะตัะธัะต ะฒัะต, ััะพ ะฒั ะฝะฐะฟะธัะฐะปะธ ะฝะฐ ะฟัะตะดัะดััะธั ัะฐะณะฐั, ะฒ ะบัะฐัะธะฒัั, ะฒะดะพัะฝะพะฒะปััััั ัะพัะผัะปะธัะพะฒะบั",
          tips: [
            "โจ *ะกะพะฒะตั:* ะัะพัะธัะฐะนัะต ัะตะปั ะฒัะปัั. ะะฒััะธั ะปะธ ะพะฝะฐ ะฒะดะพัะฝะพะฒะปัััะต?",
            "๐ฏ *ะัะพะฒะตัะบะฐ:* ะะพะถะตัะต ะปะธ ะฒั ะฟัะตะดััะฐะฒะธัั ัะตะฑั ะดะพััะธะณะฐััะธะผ ััะพะน ัะตะปะธ?",
            "๐ *ะคะธะฝะฐะป:* ะะพะทะดัะฐะฒััะต ัะตะฑั โ ะฒั ัะพะทะดะฐะปะธ ะผะพัะฝัะน ะธะฝััััะผะตะฝั ะดะปั ะธะทะผะตะฝะตะฝะธะน!"
          ]
        }
      }.freeze
      
      # ะัะธะผะตัั SMART-ัะตะปะตะน ะดะปั ะฒะดะพัะฝะพะฒะตะฝะธั
      SMART_EXAMPLES = [
        {
          domain: "ะะดะพัะพะฒัะต ะธ ัะฝะตัะณะธั",
          goal: "ะฏ ะฑัะดั ะทะฐะฝะธะผะฐัััั ััะฝะบัะธะพะฝะฐะปัะฝัะผ ััะตะฝะธะฝะณะพะผ 3 ัะฐะทะฐ ะฒ ะฝะตะดะตะปั ะฟะพ 45 ะผะธะฝัั ะฒ ัะธัะฝะตั-ะบะปัะฑะต 'ะะดะพัะพะฒัะต', ััะพะฑั ะฟะพะฒััะธัั ะฒัะฝะพัะปะธะฒะพััั ะธ ัะฝะธะทะธัั ััะพะฒะตะฝั ัััะตััะฐ. ะญัะพ ะดะพััะธะถะธะผะพ ะฑะปะฐะณะพะดะฐัั ะฐะฑะพะฝะตะผะตะฝัั ะธ ะณะธะฑะบะพะผั ะณัะฐัะธะบั ัะฐะฑะพัั. ะฆะตะปั ัะพะพัะฒะตัััะฒัะตั ะผะพะตะผั ะถะตะปะฐะฝะธั ะฑััั ะฐะบัะธะฒะฝัะผ ะธ ะทะดะพัะพะฒัะผ ะฒ ะปัะฑะพะผ ะฒะพะทัะฐััะต. ะะฐัะฝั ั 10 ัะตะฒัะฐะปั ะธ ะฒัะนะดั ะฝะฐ ัะตะณัะปััะฝัะน ัะตะถะธะผ ะบ 1 ะผะฐั.",
          results: "ะงะตัะตะท 3 ะผะตัััะฐ: +30% ะฒัะฝะพัะปะธะฒะพััะธ, -15% ัััะตััะฐ, +5 ะบะณ ะผััะตัะฝะพะน ะผะฐััั"
        },
        {
          domain: "ะะฐััะตัะฐ ะธ ัะฐะทะฒะธัะธะต",
          goal: "ะฏ ะพัะฒะพั Python ะดะปั ะฐะฝะฐะปะธะทะฐ ะดะฐะฝะฝัั ะทะฐ 4 ะผะตัััะฐ, ัะดะตะปัั 6 ัะฐัะพะฒ ะฒ ะฝะตะดะตะปั ะฝะฐ ะบัััะฐั Stepik ะธ ะฟัะฐะบัะธะบะต ะฝะฐ Kaggle, ััะพะฑั ะฟะตัะตะนัะธ ะฒ ะพัะดะตะป data science. ะญัะพ ัะตะฐะปะธััะธัะฝะพ ะฑะปะฐะณะพะดะฐัั ะผะพะตะผั ะผะฐัะตะผะฐัะธัะตัะบะพะผั ะฑัะบะณัะฐัะฝะดั ะธ ะฟะพะดะดะตัะถะบะต ะผะตะฝัะพัะฐ. ะฆะตะปั ัะพะพัะฒะตัััะฒัะตั ะผะพะตะน ะดะพะปะณะพััะพัะฝะพะน ะบะฐััะตัะฝะพะน ััะฐะตะบัะพัะธะธ ะฒ IT. ะะฐะฒะตััั ะพัะฝะพะฒะฝะพะน ะบััั ะบ 1 ะธัะฝั ะธ ะฒัะฟะพะปะฝั 2 ัะตะฐะปัะฝัั ะฟัะพะตะบัะฐ ะบ 1 ะฐะฒะณัััะฐ.",
          results: "ะะตะทัะปััะฐั: ัะตััะธัะธะบะฐั, ะฟะพัััะพะปะธะพ ะธะท 2 ะฟัะพะตะบัะพะฒ, ะณะพัะพะฒะฝะพััั ะบ ัะพะฑะตัะตะดะพะฒะฐะฝะธัะผ"
        },
        {
          domain: "ะคะธะฝะฐะฝัั ะธ ะฑะปะฐะณะพะฟะพะปััะธะต",
          goal: "ะฏ ัะพะทะดะฐะผ ัะธะฝะฐะฝัะพะฒัั ะฟะพะดััะบั ะฑะตะทะพะฟะฐัะฝะพััะธ ะฒ 150 000 ััะฑะปะตะน ะทะฐ 9 ะผะตัััะตะฒ, ะพัะบะปะฐะดัะฒะฐั ะฟะพ 16 700 ััะฑะปะตะน ะฒ ะผะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะฟะตัะตะฒะพะดะพะผ ะฝะฐ ะฝะฐะบะพะฟะธัะตะปัะฝัะน ััะตั. ะญัะพ ะดะพััะธะถะธะผะพ ะฟัะธ ะผะพะตะน ัะตะบััะตะน ะทะฐัะฟะปะฐัะต ะฟะพัะปะต ะพะฟัะธะผะธะทะฐัะธะธ ัะฐััะพะดะพะฒ. ะฆะตะปั ะฒะฐะถะฝะฐ ะดะปั ะผะพะตะณะพ ััะฒััะฒะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ ะธ ัะฒะพะฑะพะดั. ะะฐัะฝั ั ะผะฐััะฐ ะธ ะดะพััะธะณะฝั ััะผะผั ะบ 1 ะดะตะบะฐะฑัั.",
          results: "ะคะธะฝะฐะฝัะพะฒะฐั ะฑะตะทะพะฟะฐัะฝะพััั, ะผะตะฝััะต ัััะตััะฐ ะพ ะดะตะฝัะณะฐั, ะฒะพะทะผะพะถะฝะพััั ะฑัะฐัั ัะธัะบะธ ะฒ ะบะฐััะตัะต"
        }
      ].freeze
      
      # ะกัะตัั ะถะธะทะฝะธ ั ะพะฟะธัะฐะฝะธะตะผ
      LIFE_DOMAINS = [
        {
          emoji: "๐", 
          name: "ะะฐััะตัะฐ ะธ ัะฐะทะฒะธัะธะต", 
          key: "career",
          description: "ะัะพัะตััะธะพะฝะฐะปัะฝัะน ัะพัั, ะฝะฐะฒัะบะธ, ะพะฑัะฐะทะพะฒะฐะฝะธะต, ะฟัะพะตะบัั",
          questions: "ะงัะพ ั ัะพัั ะดะพััะธัั ะฒ ะบะฐััะตัะต? ะะฐะบะธะต ะฝะฐะฒัะบะธ ัะฐะทะฒะธัั?"
        },
        {
          emoji: "โค๏ธ", 
          name: "ะะดะพัะพะฒัะต ะธ ัะฝะตัะณะธั", 
          key: "health",
          description: "ะคะธะทะธัะตัะบะพะต ะธ ะผะตะฝัะฐะปัะฝะพะต ะทะดะพัะพะฒัะต, ัะฝะตัะณะธั, ะถะธะทะฝะตะฝะฝะฐั ัะธะปะฐ",
          questions: "ะะฐะบ ั ัะพัั ััะฒััะฒะพะฒะฐัั ัะตะฑั ะบะฐะถะดัะน ะดะตะฝั? ะะฐะบะพะต ะทะดะพัะพะฒัะต ะผะฝะต ะฝัะถะฝะพ ะดะปั ะผะพะธั ัะตะปะตะน?"
        },
        {
          emoji: "๐ค", 
          name: "ะัะฝะพัะตะฝะธั ะธ ะพะฑัะตะฝะธะต", 
          key: "relationships",
          description: "ะกะตะผัั, ะดััะทัั, ะฟะฐััะฝะตัั, ะบะพะปะปะตะณะธ, ัะพะพะฑัะตััะฒะพ",
          questions: "ะะฐะบะธะต ะพัะฝะพัะตะฝะธั ั ัะพัั ัะฐะทะฒะธะฒะฐัั? ะะฐะบะพะน ั ัะพัั ะฑััั ะฒ ะพัะฝะพัะตะฝะธัั?"
        },
        {
          emoji: "๐ฐ", 
          name: "ะคะธะฝะฐะฝัั ะธ ะฑะปะฐะณะพะฟะพะปััะธะต", 
          key: "finance",
          description: "ะะพัะพะด, ะฝะฐะบะพะฟะปะตะฝะธั, ะธะฝะฒะตััะธัะธะธ, ัะธะฝะฐะฝัะพะฒะฐั ัะฒะพะฑะพะดะฐ",
          questions: "ะะฐะบะพะต ัะธะฝะฐะฝัะพะฒะพะต ัะพััะพัะฝะธะต ะผะฝะต ะฝัะถะฝะพ ะดะปั ะบะพะผัะพััะฝะพะน ะถะธะทะฝะธ? ะะฐะบ ะดะตะฝัะณะธ ัะปัะถะฐั ะผะพะธะผ ัะตะฝะฝะพัััะผ?"
        },
        {
          emoji: "๐จ", 
          name: "ะขะฒะพััะตััะฒะพ ะธ ัะพะฑะฑะธ", 
          key: "creativity",
          description: "ะกะฐะผะพะฒััะฐะถะตะฝะธะต, ัะฒะปะตัะตะฝะธั, ะธัะบััััะฒะพ, ะผะฐััะตัััะฒะพ",
          questions: "ะงัะพ ะฟัะธะฝะพัะธั ะผะฝะต ัะฐะดะพััั ะธ ะฝะฐะฟะพะปะฝัะตั ัะฝะตัะณะธะตะน? ะ ัะตะผ ั ัะพัั ะฒััะฐะทะธัั ัะตะฑั?"
        },
        {
          emoji: "๐ง", 
          name: "ะะธัะฝะพััะฝัะน ัะพัั", 
          key: "personal_growth",
          description: "ะััะปะตะฝะธะต, ะฟัะธะฒััะบะธ, ะพัะพะทะฝะฐะฝะฝะพััั, ะฟัะธัะพะปะพะณะธัะตัะบะพะต ะฑะปะฐะณะพะฟะพะปััะธะต",
          questions: "ะะฐะบะธะผ ัะตะปะพะฒะตะบะพะผ ั ัะพัั ััะฐัั? ะะฐะบะธะต ะบะฐัะตััะฒะฐ ัะฐะทะฒะธัั?"
        },
        {
          emoji: "๐", 
          name: "ะะบะปะฐะด ะธ ะฒะปะธัะฝะธะต", 
          key: "contribution",
          description: "ะะพะผะพัั ะดััะณะธะผ, ะฒะพะปะพะฝัะตัััะฒะพ, ะฝะฐััะฐะฒะฝะธัะตััะฒะพ, ัะบะพะปะพะณะธั",
          questions: "ะะฐะบะพะน ัะปะตะด ั ัะพัั ะพััะฐะฒะธัั? ะะพะผั ั ะผะพะณั ะฑััั ะฟะพะปะตะทะตะฝ?"
        }
      ].freeze
      
      # ===== ะะฃะะะะงะะซะ ะะะขะะะซ =====
      
      def deliver_intro
        send_message(text: DAY_STEPS['intro'][:title], parse_mode: 'Markdown')
        send_message(text: DAY_STEPS['intro'][:instruction], parse_mode: 'Markdown')
        
        # ะะพะบะฐะทัะฒะฐะตะผ ะฟัะธะผะตั SMART-ัะตะปะธ
        example = SMART_EXAMPLES.sample
        example_text = <<~MARKDOWN
          **๐ ะัะธะผะตั SMART-ัะตะปะธ ะดะปั ะฒะดะพัะฝะพะฒะตะฝะธั:**

          *ะกัะตัะฐ:* #{example[:domain]}
          *ะฆะตะปั:* #{example[:goal]}
          
          *ะะถะธะดะฐะตะผัะต ัะตะทัะปััะฐัั:* #{example[:results]}

          **ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต:**
          ๐น ะะพะฝะบัะตัะฝะพะต ะดะตะนััะฒะธะต ั ะดะตัะฐะปัะผะธ
          ๐น ะะทะผะตัะธะผัะต ะฟะพะบะฐะทะฐัะตะปะธ ะธ ััะพะบะธ
          ๐น ะะตะฐะปะธััะธัะฝะฐั ะพัะตะฝะบะฐ ัะตััััะพะฒ
          ๐น ะะปัะฑะพะบะฐั ะปะธัะฝะฐั ะทะฝะฐัะธะผะพััั
          ๐น ะงะตัะบะฐั ะฒัะตะผะตะฝะฝะฐั ัะฐะผะบะฐ
        MARKDOWN
        
        send_message(text: example_text, parse_mode: 'Markdown')
        
        @user.set_self_help_step("day_#{DAY_NUMBER}_intro")
        store_day_data('current_step', 'intro')
        clear_day_data
        
        send_message(
          text: "ะะพัะพะฒั ัะพะทะดะฐัั ัะฒะพั ัะพะฑััะฒะตะฝะฝัั SMART-ัะตะปั?",
          reply_markup: day_22_start_markup
        )
      end
      
      def deliver_exercise
        @user.set_self_help_step("day_#{DAY_NUMBER}_exercise_in_progress")
        store_day_data('current_step', 'exercise_explanation')
        
        send_message(text: DAY_STEPS['exercise_explanation'][:title], parse_mode: 'Markdown')
        send_message(text: DAY_STEPS['exercise_explanation'][:instruction], parse_mode: 'Markdown')
        
        exercise_text = <<~MARKDOWN
          ๐ฏ *ะฃะฟัะฐะถะฝะตะฝะธะต: ะกะพะทะดะฐะฝะธะต SMART-ัะตะปะธ* ๐ฏ

          **ะั ะฟัะพะนะดะตะผ 7 ัะฐะณะพะฒ, ััะพะฑั ัะพะทะดะฐัั ัะตะปั, ะบะพัะพัะฐั ะดะตะนััะฒะธัะตะปัะฝะพ ะฑัะดะตั ัะฐะฑะพัะฐัั:**

          1. ๐ฏ ะัะฑะพั ััะตัั ะถะธะทะฝะธ
          2. ๐น ะะพะฝะบัะตัะฝะฐั ัะพัะผัะปะธัะพะฒะบะฐ  
          3. ๐ ะะทะผะตัะธะผัะต ะฟะพะบะฐะทะฐัะตะปะธ
          4. ๐ช ะัะพะฒะตัะบะฐ ะดะพััะธะถะธะผะพััะธ
          5. โค๏ธ ะกะฒัะทั ั ัะตะฝะฝะพัััะผะธ
          6. โฐ ะฃััะฐะฝะพะฒะปะตะฝะธะต ััะพะบะพะฒ
          7. ๐ ะัะพะณะพะฒะฐั ัะพัะผัะปะธัะพะฒะบะฐ

          **ะะตะบะพะผะตะฝะดะฐัะธะธ:**
          โข โฑ๏ธ ะัะดะตะปะธัะต 20-30 ะผะธะฝัั ะฝะฐ ัะฟัะฐะถะฝะตะฝะธะต
          โข โ๏ธ ะะธัะธัะต ะฟะพะดัะพะฑะฝะพ ะธ ะธัะบัะตะฝะฝะต
          โข ๐ญ ะัะฒะตัะฐะนัะต ะฝะฐ ะฒะพะฟัะพัั ะดะปั ัะฐะผะพะฐะฝะฐะปะธะทะฐ
          โข ๐ฏ ะะฐัะฝะธัะต ั ะพะดะฝะพะน, ัะฐะผะพะน ะฒะฐะถะฝะพะน ัะตะปะธ

          **ะะฐัะฝะตะผ?**
        MARKDOWN
        
        send_message(text: exercise_text, parse_mode: 'Markdown')
        
        # ะะฝะธัะธะฐะปะธะทะธััะตะผ ะฟัะพัะตัั
        init_smart_goal_process
      end
      
      def init_smart_goal_process
        store_day_data('smart_goals', [])
        store_day_data('current_goal_index', 0)
        store_day_data('goal_progress', {})
        
        # ะะฐัะธะฝะฐะตะผ ะฟะตัะฒัะน ัะฐะณ
        start_smart_step('choose_domain')
      end
      
      def start_smart_step(step_type)
        store_day_data('current_smart_step', step_type)
        @user.set_self_help_step("day_#{DAY_NUMBER}_waiting_for_#{step_type}")
        
        step = SMART_STEPS[step_type]
        return unless step
        
        # ะัะฟัะฐะฒะปัะตะผ ัะฐะณ ั ะบัะฐัะธะฒัะผ ะพัะพัะผะปะตะฝะธะตะผ
        send_message(text: step[:title], parse_mode: 'Markdown')
        send_message(text: step[:instruction], parse_mode: 'Markdown')
        
        # ะะพะฑะฐะฒะปัะตะผ ะฟัะธะผะตั, ะตัะปะธ ะตััั
        if step[:example].present?
          send_message(
            text: "#{step[:emoji]} *ะัะธะผะตั:* #{step[:example]}",
            parse_mode: 'Markdown'
          )
        end
        
        # ะะพะฑะฐะฒะปัะตะผ ะฟะพะดัะบะฐะทะบะธ
        if step[:tips] && step[:tips].any?
          tips_text = step[:tips].map { |tip| "โข #{tip}" }.join("\n")
          send_message(
            text: "#{step[:emoji]} *ะะพะดัะบะฐะทะบะธ:*\n#{tips_text}",
            parse_mode: 'Markdown'
          )
        end
        
        # ะะปั ะฒัะฑะพัะฐ ััะตัั ะฟะพะบะฐะทัะฒะฐะตะผ ะบะปะฐะฒะธะฐัััั
        if step_type == 'choose_domain'
          send_message(
            text: "ะัะฑะตัะธัะต ััะตัั ะถะธะทะฝะธ ะธะท ัะฟะธัะบะฐ ะธะปะธ ะฝะฐะฟะธัะธัะต ัะฒะพั:",
            reply_markup: day_22_domain_markup
          )
        else
          send_message(
            text: "#{step[:emoji]} *ะะฐะฟะธัะธัะต ะพัะฒะตั:*",
            parse_mode: 'Markdown',
            reply_markup: day_22_step_navigation_markup
          )
        end
      end
      
      def handle_smart_input(input_text)
        current_step = get_day_data('current_smart_step')
        step_config = SMART_STEPS[current_step]
        
        return false unless step_config
        
        log_info("Handling smart input for step: #{current_step}")
        
        # ะัะพะฒะตััะตะผ, ััะพ ะฒะฒะพะด ะฝะต ะฟัััะพะน
        if input_text.blank? || input_text.strip.length < 3
          send_message(text: "โ๏ธ ะะพะถะฐะปัะนััะฐ, ะฝะฐะฟะธัะธัะต ะฑะพะปะตะต ัะฐะทะฒะตัะฝัััะน ะพัะฒะตั.")
          return false
        end
        
        # ะะปั ะบะพะฝะบัะตัะฝะพะณะพ ัะฐะณะฐ ะฟัะพะฒะตััะตะผ ะดะตัะฐะปะธะทะฐัะธั
        if current_step == 'specific' && input_text.split.size < 8
          send_message(text: "โ๏ธ ะะพะฟัะพะฑัะนัะต ะดะพะฑะฐะฒะธัั ะฑะพะปััะต ะดะตัะฐะปะตะน. ะะดะต? ะะพะณะดะฐ? ะะฐะบ? ะก ะบะตะผ?")
          return false
        end
        
        # ะกะพััะฐะฝัะตะผ ะพัะฒะตั
        goal_progress = get_day_data('goal_progress') || {}
        goal_progress[current_step] = input_text.strip
        store_day_data('goal_progress', goal_progress)
        
        # ะะพะดัะฒะตัะถะดะฐะตะผ ัะพััะฐะฝะตะฝะธะต
        send_message(
          text: "โ #{step_config[:emoji]} *ะัะฒะตั ัะพััะฐะฝะตะฝ!*",
          parse_mode: 'Markdown'
        )
        
        # ะะตัะตัะพะดะธะผ ะบ ัะปะตะดัััะตะผั ัะฐะณั
        next_step = get_next_smart_step(current_step)
        
        if next_step
          sleep(1) # ะะฐัะทะฐ ะดะปั ะปัััะตะณะพ UX
          start_smart_step(next_step)
        else
          # ะัะต ัะฐะณะธ ะฒัะฟะพะปะฝะตะฝั
          complete_smart_goal
        end
        
        true
      end
      
      def complete_smart_goal
        goal_progress = get_day_data('goal_progress') || {}
        
        # ะคะพัะผะธััะตะผ ะฟะพะปะฝัั ัะตะปั
        full_goal = format_smart_goal(goal_progress)
        goal_progress['full_goal'] = full_goal
        
        # ะกะพััะฐะฝัะตะผ ัะตะปั ะฒ ัะฟะธัะพะบ
        goals = get_day_data('smart_goals') || []
        goals << goal_progress
        
        store_day_data('smart_goals', goals)
        store_day_data('goal_progress', {}) # ะัะธัะฐะตะผ ะดะปั ัะปะตะดัััะตะน ัะตะปะธ
        
        # ะะพะบะฐะทัะฒะฐะตะผ ัะตะทัะปััะฐั
        goal_number = goals.size
        
        completion_message = <<~MARKDOWN
          ๐ *ะฆะตะปั โ#{goal_number} ัะพะทะดะฐะฝะฐ!* ๐

          **๐ ะะฐัะฐ SMART-ัะตะปั:**
          #{full_goal}

          **๐ฏ ะงัะพ ะฒั ัะดะตะปะฐะปะธ:**
          โข ะัะฑัะฐะปะธ ััะตัั: #{goal_progress['choose_domain']}
          โข ะกัะพัะผัะปะธัะพะฒะฐะปะธ ะบะพะฝะบัะตัะฝะพ
          โข ะะฟัะตะดะตะปะธะปะธ ะผะตััะธะบะธ
          โข ะัะพะฒะตัะธะปะธ ัะตะฐะปะธััะธัะฝะพััั
          โข ะะฐัะปะธ ะณะปัะฑะธะฝะฝัะน ัะผััะป
          โข ะฃััะฐะฝะพะฒะธะปะธ ััะพะบะธ
          โข ะกะพะทะดะฐะปะธ ะฒะดะพัะฝะพะฒะปััััั ัะพัะผัะปะธัะพะฒะบั

          **๐ก ะกะพะฒะตั:** 
          ะกะดะตะปะฐะนัะต ัะบัะธะฝัะพั ััะพะน ัะตะปะธ ะธ ะฟะพััะฐะฒััะต ะตะณะพ ะฝะฐ ะทะฐััะฐะฒะบั ัะตะปะตัะพะฝะฐ. 
          ะะฐะถะดัะน ะดะตะฝั ะฝะฐะฟะพะผะธะฝะฐะนัะต ัะตะฑะต, ะบ ัะตะผั ะฒั ะธะดะตัะต.
        MARKDOWN
        
        send_message(text: completion_message, parse_mode: 'Markdown')
        
        # ะัะตะดะปะฐะณะฐะตะผ ัะปะตะดัััะธะต ะดะตะนััะฒะธั
        if goal_number < 3
          send_message(
            text: "ะฃ ะฒะฐั #{goal_number} ะธะท 3 ะฒะพะทะผะพะถะฝัั ัะตะปะตะน. ะฅะพัะธัะต ัะพะทะดะฐัั ะตัะต ะพะดะฝั?",
            reply_markup: day_22_goal_completion_markup(goal_number)
          )
        else
          send_message(
            text: "๐ฏ ะฃ ะฒะฐั ะผะฐะบัะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ัะตะปะตะน (3). ะะตะบะพะผะตะฝะดัะตััั ัะพััะตะดะพัะพัะธัััั ะฝะฐ ะฝะธั.",
            reply_markup: day_22_final_completion_markup
          )
        end
      end
      
      def complete_exercise
        goals = get_day_data('smart_goals') || []
        
        if goals.empty?
          send_message(
            text: "โ๏ธ ะฃ ะฒะฐั ะฝะตั ัะพะทะดะฐะฝะฝัั ัะตะปะตะน. ะฅะพัะธัะต ัะพะทะดะฐัั ัะพัั ะฑั ะพะดะฝั?",
            reply_markup: {
              inline_keyboard: [
                [{ text: "๐ฏ ะกะพะทะดะฐัั ัะตะปั", callback_data: 'day_22_start_goal' }]
              ]
            }
          )
          return false
        end
        
        store_day_data('final_goals', goals)
        store_day_data('completion_time', Time.current)
        
        @user.complete_self_help_day(DAY_NUMBER)
        @user.set_self_help_step("day_#{DAY_NUMBER}_completed")
        
        # ะะพะบะฐะทัะฒะฐะตะผ ะทะฐะฒะตััะตะฝะธะต
        show_smart_completion
      end
      
      def show_smart_completion
        send_message(text: DAY_STEPS['completion'][:title], parse_mode: 'Markdown')
        send_message(text: DAY_STEPS['completion'][:instruction], parse_mode: 'Markdown')
        
        # ะะพะบะฐะทัะฒะฐะตะผ ัะฒะพะดะบั ัะตะปะตะน
        show_goals_summary
        
        sleep(2)
        
        # ะะฐะถะฝัะต ะฝะฐะฟะพะผะธะฝะฐะฝะธั
        reminders = <<~MARKDOWN
          ๐ก *ะะฐะถะฝัะต ะฝะฐะฟะพะผะธะฝะฐะฝะธั ะพ ะฒะฐัะธั SMART-ัะตะปัั:*

          1. ๐ **ะะปะฐะฝะธััะนัะต ะตะถะตะฝะตะดะตะปัะฝะพ:**
             โข ะะฐะถะดะพะต ะฒะพัะบัะตัะตะฝัะต ะฟัะพัะผะฐััะธะฒะฐะนัะต ัะตะปะธ
             โข ะัะผะตัะฐะนัะต ะฟัะพะณัะตัั
             โข ะะพััะตะบัะธััะนัะต ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ

          2. ๐ฏ **ะะฐะทะฑะธะฒะฐะนัะต ะฝะฐ ัะฐะณะธ:**
             โข ะะตัััะฝัะต ะทะฐะดะฐัะธ
             โข ะะถะตะฝะตะดะตะปัะฝัะต ะดะตะนััะฒะธั
             โข ะะถะตะดะฝะตะฒะฝัะต ะฟัะธะฒััะบะธ

          3. ๐ **ะััะปะตะถะธะฒะฐะนัะต ะฟัะพะณัะตัั:**
             โข ะัะฟะพะปัะทัะนัะต ััะตะบะตัั (Notion, Excel, ะฟัะธะปะพะถะตะฝะธั)
             โข ะะตะปะฐะนัะต ะทะฐะผะตัะบะธ ะพ ะดะพััะธะถะตะฝะธัั
             โข ะัะผะตัะฐะนัะต ะผะฐะปะตะฝัะบะธะต ะฟะพะฑะตะดั

          4. ๐ค **ะะฐะนะดะธัะต ะฟะพะดะดะตัะถะบั:**
             โข ะะฐััะบะฐะถะธัะต ะพ ัะตะปัั ะฑะปะธะทะบะพะผั ัะตะปะพะฒะตะบั
             โข ะะฐะนะดะธัะต ะฟะฐััะฝะตัะฐ ะฟะพ ะฟะพะดะพััะตัะฝะพััะธ
             โข ะัะธัะพะตะดะธะฝะธัะตัั ะบ ัะตะผะฐัะธัะตัะบะธะผ ัะพะพะฑัะตััะฒะฐะผ

          5. ๐ **ะัะฐะทะดะฝัะนัะต ััะฟะตัะธ:**
             โข ะะฐะถะดะพะต ะผะธะบัะพ-ะดะพััะธะถะตะฝะธะต
             โข ะัะพะนะดะตะฝะฝัะต ะฒะตัะธ
             โข ะัะตะพะดะพะปะตะฝะฝัะต ัััะดะฝะพััะธ

          **ะะฐัะธ ัะตะปะธ โ ััะพ ะฒะฐั ะผะพัั ะบ ะถะตะปะฐะตะผะพะผั ะฑัะดััะตะผั.**
          **ะะฐะถะดัะน ะดะตะฝั ะผะฐะปะตะฝัะบะธะผะธ ัะฐะณะฐะผะธ โ ะธ ะฒั ะฟัะธะดะตัะต ะบ ะฑะพะปััะธะผ ัะตะทัะปััะฐัะฐะผ.**
        MARKDOWN
        
        send_message(text: reminders, parse_mode: 'Markdown')
        
        # ะัะตะดะปะฐะณะฐะตะผ ัะปะตะดัััะธะน ะดะตะฝั
        propose_next_day_with_restriction
      end
      
      def show_goals_summary(goals = nil)
        goals ||= get_day_data('smart_goals') || []
        
        if goals.empty?
          send_message(text: "๐ญ ะฃ ะฒะฐั ะฟะพะบะฐ ะฝะตั ัะพะทะดะฐะฝะฝัั ัะตะปะตะน.")
          return
        end
        
        summary = <<~MARKDOWN
          ๐ *ะกะฒะพะดะบะฐ ะฒะฐัะธั SMART-ัะตะปะตะน*
          
          ะัะตะณะพ ัะตะปะตะน: #{goals.size}
          
          โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        MARKDOWN
        
        goals.each_with_index do |goal, index|
          domain = goal['choose_domain'] || 'ะะต ัะบะฐะทะฐะฝะฐ'
          full_goal = goal['full_goal'] || format_smart_goal(goal)
          
          summary += <<~MARKDOWN

            **ะฆะตะปั ##{index + 1}: #{domain}**
            
            #{full_goal}
            
            โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          MARKDOWN
        end
        
        send_message(text: summary, parse_mode: 'Markdown')
        
        # ะัะตะดัะฟัะตะถะดะตะฝะธะต ะพ ัะบัะธะฝัะพัะฐั
        if goals.any?
          send_message(
            text: "โ๏ธ *ะะฐะถะฝะพ:* ะกะดะตะปะฐะนัะต ัะบัะธะฝัะพั ะฒะฐัะธั ัะตะปะตะน ะธะปะธ ัะพััะฐะฝะธัะต ะธั ะฒ ะฝะฐะดะตะถะฝะพะผ ะผะตััะต. ะญัะธ ัะพัะผัะปะธัะพะฒะบะธ โ ะฒะฐั ะฟะปะฐะฝ ะดะตะนััะฒะธะน ะฝะฐ ะฑะปะธะถะฐะนัะธะต ะผะตัััั.",
            parse_mode: 'Markdown'
          )
        end
      end
      
      def add_another_goal
        goals = get_day_data('smart_goals') || []
        
        if goals.size >= 3
          send_message(
            text: "๐ฏ ะฃ ะฒะฐั ัะถะต 3 ัะตะปะธ โ ะผะฐะบัะธะผะฐะปัะฝะพะต ัะตะบะพะผะตะฝะดัะตะผะพะต ะบะพะปะธัะตััะฒะพ. ะกะพััะตะดะพัะพัััะตัั ะฝะฐ ะธั ะดะพััะธะถะตะฝะธะธ.",
            parse_mode: 'Markdown'
          )
          show_goals_summary
          return
        end
        
        send_message(
          text: "ะัะปะธัะฝะพ! ะกะพะทะดะฐะดะธะผ ะตัะต ะพะดะฝั ัะตะปั. ะะพะผะฝะธัะต: ะปัััะต 2-3 ะฟัะพะดัะผะฐะฝะฝัั ัะตะปะธ, ัะตะผ 10 ัะฐะทะผัััั.",
          parse_mode: 'Markdown'
        )
        
        start_smart_step('choose_domain')
      end
      
      def show_smart_examples
        examples_text = <<~MARKDOWN
          ๐ *ะัะธะผะตัั SMART-ัะตะปะตะน ะดะปั ะฒะดะพัะฝะพะฒะตะฝะธั*
          
          ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต ะฝะฐ ััััะบัััั, ะดะตัะฐะปะธะทะฐัะธั ะธ ัะฒัะทั ั ัะตะฝะฝะพัััะผะธ:
        MARKDOWN
        
        send_message(text: examples_text, parse_mode: 'Markdown')
        
        SMART_EXAMPLES.each_with_index do |example, index|
          example_message = <<~MARKDOWN
            **ะัะธะผะตั ##{index + 1}: #{example[:domain]}**
            
            *ะฆะตะปั:* #{example[:goal]}
            
            *ะะถะธะดะฐะตะผัะต ัะตะทัะปััะฐัั:* #{example[:results]}
            
            โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          MARKDOWN
          
          send_message(text: example_message, parse_mode: 'Markdown')
        end
        
        send_message(
          text: "๐ก ะัะฟะพะปัะทัะนัะต ััะธ ะฟัะธะผะตัั ะบะฐะบ ัะฐะฑะปะพะฝั, ะฝะพ ะพะฑัะทะฐัะตะปัะฝะพ ะฐะดะฐะฟัะธััะนัะต ะฟะพะด ัะฒะพะธ ัะตะฝะฝะพััะธ ะธ ะพะฑััะพััะตะปัััะฒะฐ.",
          parse_mode: 'Markdown',
          reply_markup: {
            inline_keyboard: [
              [{ text: "๐ฏ ะกะพะทะดะฐัั ัะฒะพั ัะตะปั", callback_data: 'day_22_start_goal' }]
            ]
          }
        )
      end
      
      # ===== ะะะะะะะขะะ ะะะะะะ =====
      
      def handle_button(callback_data)
        case callback_data
        when 'start_day_22_content', 'start_day_22_from_proposal'
          deliver_intro
          
        when 'continue_day_22_content'
          current_step = get_day_data('current_step')
          handle_resume_from_step(current_step || 'intro')
          
        when 'start_day_22_exercise', 'day_22_start_goal'
          deliver_exercise
          
        when 'day_22_show_examples'
          show_smart_examples
          
        when /^day_22_domain_(.+)$/
          handle_domain_selection($1)
          
        when 'day_22_add_goal'
          add_another_goal
          
        when 'day_22_show_goals'
          show_goals_summary
          
        when 'day_22_complete_exercise'
          complete_exercise
          
        when 'day_22_skip_step'
          handle_skip_step
          
        when 'day_22_restart_goal'
          send_message(text: "๐ ะะฐัะธะฝะฐะตะผ ัะตะปั ะทะฐะฝะพะฒะพ ั ัะธััะพะณะพ ะปะธััะฐ.")
          start_smart_step('choose_domain')
          
        when 'day_22_previous_step'
          handle_previous_step
          
        when 'retry_day_22_exercise'
          handle_retry_exercise
          
        else
          log_warn("Unknown button callback: #{callback_data}")
          send_message(text: "ะะตะธะทะฒะตััะฝะฐั ะบะพะผะฐะฝะดะฐ. ะะพะถะฐะปัะนััะฐ, ะธัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบะธ ะผะตะฝั.")
        end
      end
      
      def handle_domain_selection(domain_key)
        domain = LIFE_DOMAINS.find { |d| d[:key] == domain_key }
        
        if domain
          domain_text = "#{domain[:emoji]} #{domain[:name]}: #{domain[:description]}"
          
          # ะกะพััะฐะฝัะตะผ ะฒัะฑะพั
          goal_progress = get_day_data('goal_progress') || {}
          goal_progress['choose_domain'] = domain_text
          store_day_data('goal_progress', goal_progress)
          
          send_message(
            text: "โ ะัะฑัะฐะฝะพ: #{domain_text}",
            parse_mode: 'Markdown'
          )
          
          # ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะฒะพะฟัะพัั ะดะปั ัะฐะทะผััะปะตะฝะธั
          if domain[:questions].present?
            send_message(
              text: "๐ญ *ะะพะฟัะพัั ะดะปั ัะฐะทะผััะปะตะฝะธั:*\n#{domain[:questions]}",
              parse_mode: 'Markdown'
            )
          end
          
          # ะะตัะตัะพะดะธะผ ะบ ัะปะตะดัััะตะผั ัะฐะณั
          start_smart_step('specific')
        else
          send_message(text: "โ๏ธ ะะตะธะทะฒะตััะฝะฐั ััะตัะฐ. ะะพะถะฐะปัะนััะฐ, ะฒัะฑะตัะธัะต ะธะท ัะฟะธัะบะฐ ะธะปะธ ะฝะฐะฟะธัะธัะต ัะฒะพั.")
        end
      end
      
      def handle_skip_step
        current_step = get_day_data('current_smart_step')
        
        if current_step && current_step != 'summary'
          next_step = get_next_smart_step(current_step)
          if next_step
            send_message(
              text: "โญ๏ธ ะจะฐะณ '#{SMART_STEPS[current_step][:title]}' ะฟัะพะฟััะตะฝ. ะะตัะตัะพะดะธะผ ะบ ัะปะตะดัััะตะผั.",
              parse_mode: 'Markdown'
            )
            start_smart_step(next_step)
          else
            complete_smart_goal
          end
        else
          send_message(text: "โ๏ธ ะะตะปัะทั ะฟัะพะฟัััะธัั ะธัะพะณะพะฒัะน ัะฐะณ.")
        end
      end
      
      def handle_previous_step
        current_step = get_day_data('current_smart_step')
        previous_step = get_previous_smart_step(current_step)
        
        if previous_step
          send_message(
            text: "๐ ะะพะทะฒัะฐัะฐะตะผัั ะบ ะฟัะตะดัะดััะตะผั ัะฐะณั.",
            parse_mode: 'Markdown'
          )
          start_smart_step(previous_step)
        else
          send_message(text: "โ๏ธ ะญัะพ ะฟะตัะฒัะน ัะฐะณ, ะฒะพะทะฒัะฐัะฐัััั ะฝะตะบัะดะฐ.")
        end
      end
      
      def handle_retry_exercise
        # ะัะธัะฐะตะผ ะดะฐะฝะฝัะต ะดะฝั
        clear_day_data
        store_day_data('current_step', nil)
        
        # ะกะฑัะฐััะฒะฐะตะผ ัะพััะพัะฝะธะต
        @user.set_self_help_step("day_#{DAY_NUMBER}_intro")
        
        send_message(
          text: "๐ ะะฐัะธะฝะฐะตะผ ะะตะฝั 22 ะทะฐะฝะพะฒะพ!",
          parse_mode: 'Markdown'
        )
        
        deliver_intro
      end
      
      # ===== ะะะะะะะขะะ ะขะะะกะขะะะะะ ะะะะะ =====
      
      def handle_text_input(input_text)
        log_info("Handling text input for day 22: #{input_text.truncate(50)}")
        
        current_state = @user.self_help_state
        
        # ะัะพะฒะตััะตะผ, ะฝะฐ ะบะฐะบะพะผ ัะฐะณะต SMART ะผั ะฝะฐัะพะดะธะผัั
        SMART_STEPS.keys.each do |step_key|
          if current_state == "day_#{DAY_NUMBER}_waiting_for_#{step_key}"
            return handle_smart_input(input_text)
          end
        end
        
        # ะะฑัะฐะฑะพัะบะฐ ัะตะบััะพะฒะพะณะพ ะฒัะฑะพัะฐ ััะตัั (ะตัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะธัะตั, ะฐ ะฝะต ะฒัะฑะธัะฐะตั ะบะฝะพะฟะบะพะน)
        if current_state == "day_#{DAY_NUMBER}_waiting_for_choose_domain"
          goal_progress = get_day_data('goal_progress') || {}
          goal_progress['choose_domain'] = input_text.strip
          store_day_data('goal_progress', goal_progress)
          
          send_message(
            text: "โ ะัะฑัะฐะฝะพ: #{input_text.strip}",
            parse_mode: 'Markdown'
          )
          
          start_smart_step('specific')
          return true
        end
        
        log_warn("No text input handler for current state: #{current_state}")
        false
      end
      
      # ===== ะะะกะกะขะะะะะะะะะ ะกะะกะกะะ =====
      
      def resume_session
        current_state = @user.self_help_state
        
        case current_state
        when "day_#{DAY_NUMBER}_intro"
          deliver_exercise
          
        when "day_#{DAY_NUMBER}_exercise_in_progress"
          current_step = get_day_data('current_step')
          if current_step.present?
            handle_resume_from_step(current_step)
          else
            deliver_exercise
          end
          
        when /^day_#{DAY_NUMBER}_waiting_for_/
          current_step = get_day_data('current_smart_step')
          if current_step.present?
            start_smart_step(current_step)
          else
            deliver_exercise
          end
          
        when "day_#{DAY_NUMBER}_goal_completed"
          goals = get_day_data('smart_goals') || []
          if goals.any?
            goal_number = goals.size
            send_message(
              text: "ะั ัะพะทะดะฐะปะธ #{goal_number} ัะตะปั(ะตะน). ะฅะพัะธัะต ัะพะทะดะฐัั ะตัะต ะธะปะธ ะทะฐะฒะตััะธัั ัะฟัะฐะถะฝะตะฝะธะต?",
              reply_markup: day_22_goal_completion_markup(goal_number)
            )
          else
            deliver_exercise
          end
          
        when "day_#{DAY_NUMBER}_completed"
          show_smart_completion
          
        else
          log_warn("Unknown or invalid state for resume: #{current_state}")
          deliver_intro
        end
      end
      
      def handle_resume_from_step(step)
        case step
        when 'intro'
          deliver_intro
        when 'exercise_explanation'
          deliver_exercise
        when 'completion'
          show_smart_completion
        else
          deliver_exercise
        end
      end
      
      def propose_next_day_with_restriction
        next_day = 23
        
        can_start_result = @user.can_start_day?(next_day)
        
        if can_start_result == true
          message = <<~MARKDOWN
            ๐ฏ **ะกะปะตะดัััะธะน ัะฐะณ: ะะตะฝั #{next_day}**
            
            โ *ะะพัััะฟะตะฝ ัะตะนัะฐั!*
            
            **ะงัะพ ะฒะฐั ะถะดะตั:**
            โข ๐ ะกะพะทะดะฐะฝะธะต ะฒะธะดะตะฝะธั ะธะดะตะฐะปัะฝะพะณะพ ะดะฝั
            โข ๐ฏ ะัะพะตะบัะธัะพะฒะฐะฝะธะต ัััะธะฝ ะธ ัะธััะฐะปะพะฒ
            โข ๐ก ะะฟัะธะผะธะทะฐัะธั ะฒัะตะผะตะฝะธ ะธ ัะฝะตัะณะธะธ
            โข ๐ ะะฐะปะฐะฝั ัะฐะฑะพัั ะธ ะพัะดััะฐ
            โข ๐ ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะฝะฐ ะพัะฝะพะฒะต ัะตะฝะฝะพััะตะน
            
            ะั ะผะพะถะตัะต ะฝะฐัะฐัั ัะปะตะดัััะธะน ะดะตะฝั ะฟััะผะพ ัะตะนัะฐั.
          MARKDOWN
          
          button_text = "๐ ะะฐัะฐัั ะะตะฝั #{next_day}"
          callback_data = "start_day_#{next_day}_from_proposal"
        else
          error_message = can_start_result.is_a?(Array) ? can_start_result.join("\n") : can_start_result
          
          message = <<~MARKDOWN
            ๐ฏ **ะกะปะตะดัััะธะน ัะฐะณ: ะะตะฝั #{next_day}**
            
            โฑ๏ธ *ะะณัะฐะฝะธัะตะฝะธะต:* #{error_message}
            
            **ะะพะบะฐ ะถะดะตัะต, ะผะพะถะตัะต:**
            โข ๐ฏ ะะตัะตัะผะพััะตัั ะธ ััะพัะฝะธัั ัะฒะพะธ SMART-ัะตะปะธ
            โข ๐ ะะฐะฟะปะฐะฝะธัะพะฒะฐัั ะฟะตัะฒัะต ัะฐะณะธ ะฟะพ ัะตะปัะผ
            โข ๐ ะกะพะทะดะฐัั ััะตะบะตั ะฟัะพะณัะตััะฐ
            โข ๐ญ ะะพัะฐะทะผััะปััั ะพ ัะพะผ, ะบะฐะบ ัะตะปะธ ัะพะณะปะฐัััััั ะดััะณ ั ะดััะณะพะผ
            โข ๐ค ะะฑััะดะธัั ัะตะปะธ ั ะฑะปะธะทะบะธะผะธ ะธะปะธ ะฝะฐััะฐะฒะฝะธะบะพะผ
            
            **ะกะพะฒะตั ะฝะฐ ัะตะณะพะดะฝั:** 
            ะะฐัะฝะธัะต ะดะตะนััะฒะพะฒะฐัั ะฟะพ ัะฐะผะพะน ะฒะฐะถะฝะพะน ัะตะปะธ ะฟััะผะพ ัะตะนัะฐั. 
            ะะฐะถะต 15 ะผะธะฝัั ะฒ ะดะตะฝั ัะพะทะดะฐัั ะธะผะฟัะปัั.
          MARKDOWN
          
          button_text = "โฑ๏ธ ะัะพะฒะตัะธัั ะดะพัััะฟะฝะพััั ะะฝั #{next_day}"
          callback_data = "start_day_#{next_day}_from_proposal"
        end
        
        send_message(text: message, parse_mode: 'Markdown')
        
        send_message(
          text: "ะะฐะถะผะธัะต ะบะฝะพะฟะบั:",
          reply_markup: {
            inline_keyboard: [
              [
                { 
                  text: button_text, 
                  callback_data: callback_data
                }
              ]
            ]
          }
        )
      end
      
      private
      
      def get_next_smart_step(current_step)
        steps_order = SMART_STEPS.keys
        current_index = steps_order.index(current_step)
        
        return steps_order[current_index + 1] if current_index && current_index < steps_order.length - 1
        nil
      end
      
      def get_previous_smart_step(current_step)
        steps_order = SMART_STEPS.keys
        current_index = steps_order.index(current_step)
        
        return steps_order[current_index - 1] if current_index && current_index > 0
        nil
      end
      
      def format_smart_goal(goal_progress)
        domain = goal_progress['choose_domain'] || 'ะัะฑัะฐะฝะฝะฐั ััะตัะฐ'
        specific = goal_progress['specific'] || 'ะะพะฝะบัะตัะฝะพะต ะดะตะนััะฒะธะต'
        measurable = goal_progress['measurable'] || 'ะะทะผะตัะธะผัะน ะฟะพะบะฐะทะฐัะตะปั'
        achievable = goal_progress['achievable'] || 'ะะตะฐะปะธััะธัะฝะพััั'
        relevant = goal_progress['relevant'] || 'ะะธัะฝะฐั ะทะฝะฐัะธะผะพััั'
        time_bound = goal_progress['time_bound'] || 'ะกัะพะบะธ'
        
        <<~GOAL
          ะฏ ะฑัะดั #{specific.downcase}, ััะพะฑั #{measurable.downcase}. 
          ะญัะพ ะดะพััะธะถะธะผะพ, ะฟะพัะพะผั ััะพ #{achievable.downcase}. 
          ะฆะตะปั ะฒะฐะถะฝะฐ ะดะปั ะผะตะฝั, ัะฐะบ ะบะฐะบ #{relevant.downcase}. 
          ะฏ ะฝะฐัะฝั ะดะตะนััะฒะพะฒะฐัั ะธ ะดะพััะธะณะฝั ัะตะทัะปััะฐัะฐ ะบ #{time_bound.downcase}.
        GOAL
          .strip
          .gsub(/\s+/, ' ')
      end
      
      def clear_day_data
        SMART_STEPS.keys.each do |step|
          store_day_data("#{step}_response", nil)
        end
        store_day_data('current_smart_step', nil)
        store_day_data('smart_goals', nil)
        store_day_data('goal_progress', nil)
        store_day_data('final_goals', nil)
        store_day_data('completion_time', nil)
      end
      
      # ะะตัะพะดั ัะฐะทะผะตัะบะธ
      def day_22_start_markup
        {
          inline_keyboard: [
            [
              { text: "๐ฏ ะะฐัะฐัั ัะพะทะดะฐะฝะธะต ัะตะปะตะน", callback_data: 'start_day_22_exercise' },
              { text: "๐ ะะพัะผะพััะตัั ะฟัะธะผะตัั", callback_data: 'day_22_show_examples' }
            ]
          ]
        }
      end
      
      def day_22_domain_markup
        keyboard = LIFE_DOMAINS.each_slice(2).map do |pair|
          pair.map do |domain|
            { text: "#{domain[:emoji]} #{domain[:name]}", callback_data: "day_22_domain_#{domain[:key]}" }
          end
        end
        
        # ะะพะฑะฐะฒะปัะตะผ ะบะฝะพะฟะบั "ะััะณะพะต"
        keyboard << [{ text: "โ๏ธ ะััะณะฐั ััะตัะฐ (ะพะฟะธัั)", callback_data: "day_22_domain_other" }]
        
        { inline_keyboard: keyboard }
      end
      
      def day_22_step_navigation_markup
        {
          inline_keyboard: [
            [
              { text: "๐ ะะฐะทะฐะด", callback_data: 'day_22_previous_step' },
              { text: "โฉ ะัะพะฟัััะธัั", callback_data: 'day_22_skip_step' },
              { text: "๐ ะะฐัะฐัั ะทะฐะฝะพะฒะพ", callback_data: 'day_22_restart_goal' }
            ]
          ]
        }
      end
      
      def day_22_goal_completion_markup(goal_count)
        keyboard = []
        
        if goal_count < 3
          keyboard << [
            { text: "โ ะะพะฑะฐะฒะธัั ะตัะต ัะตะปั", callback_data: 'day_22_add_goal' },
            { text: "โ ะะฐะฒะตััะธัั ัะพะทะดะฐะฝะธะต", callback_data: 'day_22_complete_exercise' }
          ]
        else
          keyboard << [
            { text: "โ ะะฐะฒะตััะธัั ัะพะทะดะฐะฝะธะต", callback_data: 'day_22_complete_exercise' }
          ]
        end
        
        keyboard << [
          { text: "๐ ะะพัะผะพััะตัั ะฒัะต ัะตะปะธ", callback_data: 'day_22_show_goals' }
        ]
        
        { inline_keyboard: keyboard }
      end
      
      def day_22_final_completion_markup
        {
          inline_keyboard: [
            [
              { text: "๐ ะะพะบะฐะทะฐัั ะฒัะต ัะตะปะธ", callback_data: 'day_22_show_goals' },
              { text: "๐ ะัะพะนัะธ ะทะฐะฝะพะฒะพ", callback_data: 'retry_day_22_exercise' }
            ],
            [
              { text: "โ ะะฐะฒะตััะธัั ะะตะฝั 22", callback_data: 'day_22_complete_exercise' }
            ]
          ]
        }
      end
      
      def log_info(message)
        Rails.logger.info "[#{self.class}] #{message} - User: #{@user.telegram_id}"
      end
      
      def log_warn(message)
        Rails.logger.warn "[#{self.class}] #{message} - User: #{@user.telegram_id}"
      end
      
      def log_error(message, error = nil)
        Rails.logger.error "[#{self.class}] #{message} - User: #{@user.telegram_id}"
        Rails.logger.error error.message if error
        Rails.logger.error error.backtrace.first(5).join("\n") if error
      end
    end
  end
end